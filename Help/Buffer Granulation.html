<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="1187.4">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000ee}
p.p4 {margin: 0.0px 0.0px 0.0px 28.0px; text-indent: -28.0px; font: 12.0px Helvetica}
p.p5 {margin: 0.0px 0.0px 0.0px 27.0px; text-indent: -27.0px; font: 12.0px Helvetica}
p.p6 {margin: 0.0px 0.0px 0.0px 27.0px; text-indent: -27.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p7 {margin: 0.0px 0.0px 0.0px 27.0px; text-indent: -27.0px; font: 12.0px Helvetica; color: #0000ee}
p.p8 {margin: 0.0px 0.0px 0.0px 28.0px; text-indent: -28.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p9 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica}
p.p10 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #d60000}
p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Monaco}
p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Monaco; color: #d60000}
p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Monaco; min-height: 12.0px}
p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Helvetica; min-height: 11.0px}
p.p18 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #cd1c00}
p.p19 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #cd1c00; min-height: 12.0px}
p.p20 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0433ff}
p.p21 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0326cb}
p.p22 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #008300}
p.p23 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica; min-height: 17.0px}
p.p24 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Monaco; color: #cd1c00}
p.p25 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0013ce}
p.p26 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #007300}
p.p27 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #606060}
p.p28 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Monaco; color: #007300}
p.p29 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Helvetica}
p.p30 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Helvetica; min-height: 11.0px}
p.p31 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 9.0px Monaco; color: #d60000; min-height: 12.0px}
p.p32 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p33 {margin: 0.0px 0.0px 0.0px 29.0px; text-indent: -29.0px; font: 12.0px Helvetica}
p.p34 {margin: 0.0px 0.0px 0.0px 29.0px; text-indent: -29.0px; font: 12.0px Helvetica; min-height: 14.0px}
span.s1 {font: 18.0px Helvetica}
span.s2 {color: #000000}
span.s3 {text-decoration: underline}
span.s4 {text-decoration: underline ; color: #00caff}
span.s5 {color: #00bbff}
span.s6 {text-decoration: underline ; color: #0095ff}
span.s7 {text-decoration: underline ; color: #003bff}
span.s8 {text-decoration: underline ; color: #0067ff}
span.s9 {color: #0013ce}
span.s10 {color: #007300}
span.s11 {color: #606060}
span.s12 {color: #0326cb}
span.s13 {color: #008300}
span.s14 {color: #0433ff}
span.s15 {color: #434ccb}
span.s16 {color: #737373}
span.s17 {color: #ff7c00}
span.s18 {text-decoration: underline ; color: #0018ff}
span.s19 {color: #d60000}
span.s20 {color: #0028f2}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>Buffer Granulation<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><b>different approaches to buffer granulation with gui examples<span class="Apple-converted-space"> </span></b><span class="s1"><b><span class="Apple-tab-span">	</span></b></span></p>
<p class="p2"><br></p>
<p class="p3"><span class="s2"><b>Part of:</b> <a href="miSCellaneous.html"><span class="s3">miSCellaneous</span></a></span></p>
<p class="p2"><br></p>
<p class="p3"><span class="s2"><b>See also:</b> <a href="VarGui.html"><span class="s4">VarGui</span></a></span><span class="s5">,</span><span class="s2"> <a href="VarGui shortcut builds.html"><span class="s3">VarGui shortcut builds</span></a></span><span class="s5">,</span><span class="s2"> <a href="PLx suite.html"><span class="s6">PLx suite</span></a></span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">As with many things in SC work can be done by language or server. Speaking about granulation in general this mainly concerns the control of single grains, their rate, timing, length and other parameters. Regarding buffer granulation specifically this task can e.g. be taken over by ugens like TGrains and GrainBuf, the latter additionally accepting a grain envelope arg. The SC plugin distribution contains further variations (see BhobUGens, JoshUGens). By using granulation ugens in a SynthDef granular textures can be produced with a single Synth, including grain parameter sequencing with demand rate ugens. Alternatively SynthDefs for single grains can be defined with PlayBuf or BufRd in order to control the whole buffer granulation process from language side, using Patterns, Tasks or Routines. What is the best way? To a large extent this is a question of personal preference. Regarding CPU performance granulation ugens have an advantage, whereas e.g. pattern-driven granulation allows concise control over the sequencing of granulation parameters in a clear syntax. If pattern-driven granulation is becoming CPU-critical you might want to consider the event type \grain, a lightweight variant of default type \note (see comment in the source file Event.sc). For granulation with Tasks see example 3 in <a href="VarGui.html"><span class="s4">VarGui</span></a>.<span class="s4"> </span><span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">Also hybrid strategies are possible, e.g. language controlled setting of a single granulation Synth or involving extra control synths in a language-driven granulation process, further options are Pspawner / Pspawn and Wavesets. VarGui can be used to integrate these setups in single GUIs. Together with this file (miSCellaneous v0.7) I reinvented a color grouping option that overrides automatic color grouping (<a href="VarGui.html"><span class="s4">VarGui</span></a>, Ex. 7). The latter is based on the logical structure of ordinary and array controls, synths and environments. This is useful for VarGuis up to a medium number of controls per Synth / Pattern / Task and also for a large number of such items, but it doesn't handle cases well where there are many controls per item. Not barely an aesthetic detail, it is much more convenient for experimenting to group all sliders of a Synth that, say, have to do with a bandpass filter, within one color.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><b>Types of variables</b></p>
<p class="p2"><br></p>
<p class="p1">In general interpreter variables are prefered in examples below, wherever possible. If evaluated with example code only their values are passed and further changing of used variables doesn't affect already generated gui instances. On the contrary repeated evaluation of an interpreter variable, e.g. from a Pfunc, is unsafe - variable's value could change while gui has not yet been closed - so in concerned examples values are passed to the event definition, in Ex. 2c a variable is declared for the same reason.<span class="Apple-converted-space"> </span></p>
<p class="p1">The use of environmental variables is following the way VarGui is handling them. Per default every EventStreamPlayer derived from a passed Pattern is run in a separate newly generated Environment, where variables are being set and Streams from Pfuncs and PLx patterns are reading from. See <a href="Event patterns and Functions.html"><span class="s7">Event patterns and Functions</span></a>, <a href="PLx suite.html"><span class="s8">PLx suite</span></a> and <a href="VarGui.html"><span class="s4">VarGui</span></a>.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><b>WARNING:</b><span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">1.) <span class="Apple-tab-span">	</span>Be careful with amplitudes, especially with buffers you haven't granulated before !</p>
<p class="p4"><span class="Apple-tab-span">	</span>Also keep in mind that a granular cloud moving through a buffer can suddenly become louder and other controls than amp (e.g. buffer position, trigger rate, bandpass parameters) can cause a raise of amplitude too.</p>
<p class="p2"><br></p>
<p class="p4">2.)<span class="Apple-tab-span">	</span>I haven't used below setups for live performances. Although all of them work stable for me as they are, in general hangs can occasionally happen with pattern-driven setups. Often this can be tracked down to sequences of extremely short event durations (and/or long grain durations). Where this can happen as a side-effect, thresholds can be built in, e.g. example 2d (Wavesets) has a parameter maxTrigRate.<span class="Apple-converted-space"> </span></p>
<p class="p4"><span class="Apple-tab-span">	</span>Another possible source of hangs is careless deep nesting of Patterns where mistakes can easily occur. Starting with clear Pattern structures is recommended - and if more complications are involved: testing without sound first, after saving your patch, might be a good idea.<span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><b>NOTE:</b><span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">All examples below expect mono buffers. Buffer paths refering to the included sample suppose that you have moved miSCellaneous lib into the user extensions directory directly (not into a subfolder), if not so or you have moved the sample file somewhere else you'd have to change paths accordingly, also in case of an install in system extensions, then use Platform.systemExtensionDir.</p>
<p class="p2"><br></p>
<p class="p1">Windows 7:<span class="Apple-converted-space">  </span>While other parts of miSCellaneous lib were running fine I was unable to allocate buffers with the SC 3.5.4 Windows binary in August 2012. Meanwhile this issue has been solved (SC 3.6.6, February 2014).</p>
<p class="p2"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><b>Credits<span class="Apple-converted-space"> </span></b></p>
<p class="p2"><br></p>
<p class="p1">Thanks for contributions and inspirations by SCers Alberto de Campo (Wavesets), James Harkins (Patterns), Ron Kuivila (Pspawner), Sergio Luque (stochastic distributions), Josh Parmenter (granulation plugins), Bhob Rainey (granulation plugins).</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><b>References</b></p>
<p class="p2"><br></p>
<p class="p5">[1]<span class="Apple-tab-span">	</span>de Campo, Alberto. "Microsound" In: Wilson, S., Cottle, D. and Collins, N. (eds). 2011.<span class="Apple-converted-space"> </span></p>
<p class="p5"><span class="Apple-tab-span">	</span><i>The SuperCollider Book</i>. Cambridge, MA: MIT Press, 463-504.</p>
<p class="p6"><span class="Apple-tab-span">	</span></p>
<p class="p5">[2]<span class="Apple-tab-span">	</span>Luque, Sergio (2006). <i>Stochastic Synthesis, Origins and Extensions</i>. Institute of Sonology, Royal Conservatory, The Netherlands.<span class="Apple-converted-space"> </span></p>
<p class="p7"><span class="s2"><span class="Apple-tab-span">	</span><a href="http://sergioluque.com/"><span class="s3">http://sergioluque.com</span></a></span></p>
<p class="p6"><br></p>
<p class="p5">[3]<span class="Apple-tab-span">	</span>Roads, Curtis (2001). <i>Microsound</i>. Cambridge, MA: MIT Press.</p>
<p class="p6"><span class="Apple-tab-span">	</span></p>
<p class="p5">[4]<span class="Apple-tab-span">	</span>Wishart, Trevor (1994). <i>Audible Design</i>. York: Orpheus The Pantomime Ltd.<span class="Apple-converted-space"> </span></p>
<p class="p6"><br></p>
<p class="p5">[5]<span class="Apple-tab-span">	</span>Xenakis, Iannis (1992). <i>Formalized Music</i>. Hillsdale, NY: Pendragon Press, 2nd Revised edition.</p>
<p class="p2"><br></p>
<p class="p8"><br></p>
<p class="p8"><span class="Apple-tab-span">	</span></p>
<p class="p9"><b><span class="s3">1.) Granulation with Ugens</span></b></p>
<p class="p10"><br></p>
<p class="p9"><b>Example 1a: <span class="Apple-converted-space">  </span>Basic buffer granulation Synth</b></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p12">s = <span class="s9">Server</span>.local;</p>
<p class="p12"><span class="s9">Server</span>.default = s;</p>
<p class="p12">s.boot;</p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p13">// basic SynthDef suited for pitch-shift and time-stretch</p>
<p class="p13">// buffer position given relatively (posLo and posHi between 0 and 1)</p>
<p class="p13">// posDev: maximum amount of deviation from (moving) grain center position</p>
<p class="p13">// posDev = 0 can lead to comb filter effects (which may be nice sometimes)</p>
<p class="p11"><br></p>
<p class="p13">// passing control specs as metadata allows for VarGui shortcut build method sVarGui</p>
<p class="p13">// metadata specs can be overwritten by arg ctrReplace</p>
<p class="p13">// alternatively control specs may be passed as synthCtr arg to a build with VarGui( ... )</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p12"><span class="s9">SynthDef</span>(<span class="s10">\gran_1a</span>, { <span class="s9">arg</span> out = 0, bufNum = 0, posLo = 0.0, posHi = 1.0,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>posRate = 1, posDev = 0.01, trigRate = 100, granDur = 0.1, rate = 1.0,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>panMax = 1, amp = 0.1, interp = 4;</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">var</span> trig, pan, pos, bufDur, bufDurSection, posDif;</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>posDif = posHi - posLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span>bufDur = <span class="s9">BufDur</span>.kr(bufNum);</p>
<p class="p12"><span class="Apple-tab-span">	</span>bufDurSection = bufDur * posDif;<span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>trig = <span class="s9">Impulse</span>.kr(trigRate);</p>
<p class="p12"><span class="Apple-tab-span">	</span>pos = posLo * bufDur +</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(<span class="s9">Phasor</span>.ar(0, <span class="s9">BufRateScale</span>.kr(bufNum) * posRate / <span class="s9">SampleRate</span>.ir, posLo * bufDur, posHi * bufDur) +<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(<span class="s9">TRand</span>.kr(-0.5 * posDev, 0.5 * posDev, trig) * bufDur)).mod(bufDurSection); <span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>pan = <span class="s9">Demand</span>.kr(trig, 0, <span class="s9">Dseq</span>([panMax, panMax.neg],<span class="s9">inf</span>) * 0.999);</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">Out</span>.ar(out, <span class="s9">TGrains</span>.ar(2, trig, bufNum, rate, pos, granDur, pan, amp, interp));</p>
<p class="p12"><span class="Apple-tab-span">	</span>}, metadata: (</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>specs: (</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posLo: [0.01, 0.99, <span class="s10">\lin</span>, 0.01, 0],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posHi: [0.01, 0.99, <span class="s10">\lin</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posRate: [0.1, 2, <span class="s10">\lin</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posDev: [0, 0.2, 5, 0, 0.01],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>granDur: [0.01, 0.3, <span class="s10">\lin</span>, 0.01, 0.1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trigRate: [1, 200, <span class="s10">\lin</span>, 0.01, 100],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>rate: [0.1, 2, <span class="s10">\lin</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>panMax: [0.0, 1, <span class="s10">\lin</span>, 0.005, 0.8],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>amp: [0.0, 0.5, <span class="s10">\lin</span>, 0.005, 0.25]</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>)</p>
<p class="p12"><span class="Apple-tab-span">	</span>)</p>
<p class="p12">).add;</p>
<p class="p11"><br></p>
<p class="p14">b = <span class="s9">Buffer</span>.read(s, <span class="s9">Platform</span>.userExtensionDir +/+ <span class="s11">"miSCellaneous"</span> +/+ <span class="s11">"Sounds"</span> +/+ <span class="s11">"kitchen_sounds_1.wav"</span>);</p>
<p class="p15">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p14">)</p>
<p class="p16"><br></p>
<p class="p16"><br></p>
<p class="p15">// start from GUI</p>
<p class="p16"><br></p>
<p class="p12"><span class="s10">\gran_1a</span>.sVarGui([<span class="s10">\bufNum</span>, b.bufnum]).gui;</p>
<p class="p11"><br></p>
<p class="p17"><br></p>
<p class="p17"><br></p>
<p class="p9"><b>Example 1b: <span class="Apple-converted-space">  </span>More deviations</b></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p13">// In example 1a only a deviation from the grain center position was implemented.</p>
<p class="p13">// With additional deviation controls a greater plasticity of sound can be achieved,</p>
<p class="p13">// here deviations are added for trigRate (LFO with oscillation freq and deviation max),</p>
<p class="p13">// grain duration and rate (TRand, equally weighted random deviation with given max).</p>
<p class="p13">// Deviations intervals could be defined alternatively,<span class="Apple-converted-space"> </span></p>
<p class="p13">// e.g. (1/(1+maxDev), 1+maxDev) with 0 &lt; maxDev</p>
<p class="p13">// instead of (1-maxDev, 1+mexDev) with 0 &lt; maxDev &lt; 1</p>
<p class="p11"><br></p>
<p class="p13">// posRate control range is widened by inventing two controls for<span class="Apple-converted-space"> </span></p>
<p class="p13">// mantissa and exponent, so posRate = 1 for init param pair<span class="Apple-converted-space"> </span></p>
<p class="p13">// posRateE = 0 and posRateM = 1</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p12"><span class="s9">SynthDef</span>(<span class="s10">\gran_1b</span>, { <span class="s9">arg</span> out = 0, bufNum = 0, posLo = 0.0, posHi = 1.0,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>posRateE = 0, posRateM = 1, posDev = 0.01, trigRate = 100, trigRateDev = 0,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>trigRateOsc = 1, granDur = 0.1, granDurDev = 0, rate = 1.0, rateDev = 0,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>panMax = 1, amp = 0.1, interp = 4;</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">var</span> trig, pan, pos, bufDur, bufDurSection, posDif, posRate;</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>posDif = posHi - posLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span>bufDur = <span class="s9">BufDur</span>.kr(bufNum);</p>
<p class="p12"><span class="Apple-tab-span">	</span>bufDurSection = bufDur * posDif;<span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>trig = <span class="s9">Impulse</span>.kr(<span class="s9">LFDNoise3</span>.kr(trigRateOsc, trigRate * trigRateDev, trigRate));</p>
<p class="p12"><span class="Apple-tab-span">	</span>posRate = 10 ** posRateE * posRateM;</p>
<p class="p12"><span class="Apple-tab-span">	</span>pos = posLo * bufDur +</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(<span class="s9">Phasor</span>.ar(0, <span class="s9">BufRateScale</span>.kr(bufNum) * posRate / <span class="s9">SampleRate</span>.ir, posLo * bufDur, posHi * bufDur) +<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(<span class="s9">TRand</span>.kr(-0.5, 0.5, trig) * posDev * bufDur)).mod(bufDurSection); <span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>pan = <span class="s9">Demand</span>.kr(trig, 0, <span class="s9">Dseq</span>([panMax, panMax.neg],<span class="s9">inf</span>) * 0.999);</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">Out</span>.ar(out, <span class="s9">TGrains</span>.ar(2, trig, bufNum, rate * (<span class="s9">TRand</span>.kr(-1, 1.0, trig) * rateDev + 1), pos,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>granDur * (<span class="s9">TRand</span>.kr(-1, 1.0, trig) * granDurDev + 1), pan, amp, interp));</p>
<p class="p12"><span class="Apple-tab-span">	</span>}, metadata: (</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>specs: (</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posLo: [0.01, 0.99, <span class="s10">\lin</span>, 0.01, 0],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posHi: [0.01, 0.99, <span class="s10">\lin</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posRateE: [-3, 4, <span class="s10">\lin</span>, 1, 0],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posRateM: [0.1, 10, <span class="s10">\exp</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posDev: [0, 0.2, 5, 0, 0.05],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trigRate: [1, 200, <span class="s10">\lin</span>, 0.01, 100],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trigRateDev: [0.0, 1, <span class="s10">\lin</span>, 0.01, 0],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trigRateOsc: [0.1, 2, <span class="s10">\lin</span>, 0.01, 3],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>granDur: [0.01, 0.3, <span class="s10">\lin</span>, 0.01, 0.1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>granDurDev: [0.0, 0.95, <span class="s10">\lin</span>, 0.01, 0],</p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>rate: [0.1, 2, <span class="s10">\lin</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>rateDev: [0.0, 0.99, <span class="s10">\linear</span>, 0.01, 0.05],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>panMax: [0.0, 1, <span class="s10">\lin</span>, 0.005, 0.8],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>amp: [0.0, 0.5, <span class="s10">\lin</span>, 0.005, 0.25]</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>)</p>
<p class="p12"><span class="Apple-tab-span">	</span>)</p>
<p class="p12">).add;</p>
<p class="p11"><br></p>
<p class="p14">b = <span class="s9">Buffer</span>.read(s, <span class="s9">Platform</span>.userExtensionDir +/+ <span class="s11">"miSCellaneous"</span> +/+ <span class="s11">"Sounds"</span> +/+ <span class="s11">"kitchen_sounds_1.wav"</span>);</p>
<p class="p15">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p14">)</p>
<p class="p16"><br></p>
<p class="p16"><br></p>
<p class="p15">// start from GUI</p>
<p class="p15">// use color grouping for better overview</p>
<p class="p11"><br></p>
<p class="p12"><span class="s10">\gran_1b</span>.sVarGui([<span class="s10">\bufNum</span>, b.bufnum]).gui(synthColorGroups: (0..14).clumps([1,5,3,2,2,1,1]) )</p>
<p class="p11"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p9"><b>Example 1c: <span class="Apple-converted-space">  </span>Buffer granulation Synth with external control synths</b></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p18">// This is a more modular approach, once having a basic granulation synth</p>
<p class="p18">// it can be linked with arbitrary control synths, here</p>
<p class="p18">// also moving through the buffer is controlled externally.</p>
<p class="p18">// Depending on LFOs it might be worth defining<span class="Apple-converted-space"> </span></p>
<p class="p18">// audio buses for control to get higher precision.</p>
<p class="p19"><br></p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p12"><span class="s12">SynthDef</span>(<span class="s13">\gran_1c</span>, { <span class="s14">arg</span> out = 0, bufNum = 0, amp = 0.1, pos = 0.5, posDev = 0.01,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>trigRate = 100, granDur = 0.1, rate = 1, panMax = 1, interp = 4;</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s14">var</span> trig, pan;</p>
<p class="p12"><span class="Apple-tab-span">	</span>trig = <span class="s12">Impulse</span>.kr(trigRate);</p>
<p class="p12"><span class="Apple-tab-span">	</span>pan = <span class="s12">Demand</span>.kr(trig, 0, <span class="s12">Dseq</span>([panMax, panMax.neg],<span class="s15">inf</span>) * 0.999);</p>
<p class="p12"><span class="Apple-tab-span">	</span>pos = (pos * <span class="s12">BufDur</span>.kr(bufNum) * <span class="s12">WhiteNoise</span>.kr(posDev, 1));</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s12">Out</span>.ar(out, <span class="s12">TGrains</span>.ar(2, trig, bufNum, rate, pos, granDur, pan, amp, interp));</p>
<p class="p12">}).add;</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p18">// LFO synthdef for switching between 3 types:<span class="Apple-converted-space"> </span></p>
<p class="p18">// 0: LFDNoise3 (smooth random movement)</p>
<p class="p18">// 1: SinOsc</p>
<p class="p18">// 2: LFSaw (works as phasor for position)</p>
<p class="p11"><br></p>
<p class="p20"><span class="s12">SynthDef</span><span class="s2">(</span><span class="s13">\lfo</span><span class="s2">, { </span>|out = 0, lfoType = 0, freq = 1, lo = 0, hi = 1|<span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s14">var</span> ctrl;</p>
<p class="p12"><span class="Apple-tab-span">	</span>ctrl = <span class="s12">Select</span>.kr(lfoType, [</p>
<p class="p21"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>LFDNoise3<span class="s2">,</span></p>
<p class="p21"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>SinOsc<span class="s2">,</span></p>
<p class="p21"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>LFSaw</p>
<p class="p12"><span class="Apple-tab-span">	</span>].collect { <span class="s14">|x|</span> x.kr(freq, mul: hi-lo/2, add: hi+lo/2) });</p>
<p class="p12">    <span class="s12">Out</span>.kr(out, ctrl);<span class="Apple-converted-space"> </span></p>
<p class="p12">}).add;<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p18">// multichannel control bus<span class="Apple-converted-space"> </span></p>
<p class="p12">c = <span class="s12">Bus</span>.control(s, 5);</p>
<p class="p11"><br></p>
<p class="p12">b = <span class="s12">Buffer</span>.read(s, <span class="s12">Platform</span>.userExtensionDir +/+ <span class="s16">"miSCellaneous"</span> +/+ <span class="s16">"Sounds"</span> +/+ <span class="s16">"kitchen_sounds_1.wav"</span>);</p>
<p class="p18">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p18">// In contrast to Ex. 1a and 1b VarGui is called explicitely</p>
<p class="p18">// as control specs should differ.</p>
<p class="p11"><br></p>
<p class="p18">// Also here the granulation Synth is generated explicitely and not by the interface</p>
<p class="p18">// as its controls have to be mapped to buses</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p18">// start granulation synth paused and register</p>
<p class="p18">// to let VarGui know its state</p>
<p class="p11"><br></p>
<p class="p12">x = <span class="s12">Synth</span>.newPaused(<span class="s13">\gran_1c</span>, [<span class="s13">\bufNum</span>, b]).register;</p>
<p class="p11"><br></p>
<p class="p18">// map args to be controlled to consecutive subbuses</p>
<p class="p12">x.map(*[[<span class="s13">\pos</span>, <span class="s13">\trigRate</span>, <span class="s13">\granDur</span>, <span class="s13">\rate</span>, <span class="s13">\panMax</span>], (0..4).collect(c.subBus(<span class="s12">_</span>))].flop.flat)</p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p18">// Open VarGui interface, granulation synth (#5) is paused</p>
<p class="p18">// (orange button on yellow background).</p>
<p class="p18">// Shift-clicking one of the green buttons runs</p>
<p class="p18">// granulation synth and control synths (#0 - #4).</p>
<p class="p18">// All synths can be paused (orange button) and resumed.</p>
<p class="p11"><br></p>
<p class="p18">// NOTE: When stopping the granulation synth<span class="Apple-converted-space"> </span></p>
<p class="p18">// the linkage with control synths is lost!<span class="Apple-converted-space"> </span></p>
<p class="p18">// A new synth generated by the interface<span class="Apple-converted-space"> </span></p>
<p class="p18">// (by pressing the blue button of #5) is not</p>
<p class="p18">// automatically mapped to control buses.</p>
<p class="p18">// On the other hand control synths might be stopped and<span class="Apple-converted-space"> </span></p>
<p class="p18">// newly generated.</p>
<p class="p19"><span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p12"><span class="s12">VarGui</span>(synthCtr: [[</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s13">\pos</span><span class="s2">, 0,<span class="Apple-tab-span">	</span></span>// dummy spec for labelling<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, c.index,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lfoType</span>, [0, 2, <span class="s13">\lin</span>, 1, 0],<span class="Apple-converted-space"> </span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// as LFOs are unified, original movement tempo is<span class="Apple-converted-space"> </span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// indicated not by 1 but by 1 / buffer duration</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, [0.01, 20, <span class="s13">\exp</span>, 0.0, 1/b.duration],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lo</span>, [0.0, 1, <span class="s13">\lin</span>, 0, 0.1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\hi</span>, [0.0, 1, <span class="s13">\lin</span>, 0, 0.9]</p>
<p class="p12"><span class="Apple-tab-span">	</span>],[</p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\trigRate<span class="s2">, 1,</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, c.index + 1,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lfoType</span>, [0, 2, <span class="s13">\lin</span>, 1, 0],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, [0.001, 0.5, <span class="s13">\exp</span>, 0.0, 0.2],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lo</span>, [1, 100, <span class="s13">\lin</span>, 0, 7],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\hi</span>, [1, 100, <span class="s13">\lin</span>, 0, 40]</p>
<p class="p12"><span class="Apple-tab-span">	</span>],[</p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, 2,</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, c.index + 2,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lfoType</span>, [0, 2, <span class="s13">\lin</span>, 1, 1],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, [0.001, 0.5, <span class="s13">\exp</span>, 0.0, 0.4],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lo</span>, [0.01, 0.2, <span class="s13">\lin</span>, 0, 0.1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\hi</span>, [0.01, 0.2, <span class="s13">\lin</span>, 0, 0.15]</p>
<p class="p12"><span class="Apple-tab-span">	</span>],[</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rate</span>, 3,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, c.index + 3,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lfoType</span>, [0, 2, <span class="s13">\lin</span>, 1, 0],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, [0.001, 0.1, <span class="s13">\exp</span>, 0.0, 0.03],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lo</span>, [0.1, 3, <span class="s13">\lin</span>, 0, 0.6],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\hi</span>, [0.1, 3, <span class="s13">\lin</span>, 0, 1.1]</p>
<p class="p12"><span class="Apple-tab-span">	</span>],[</p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\panMax<span class="s2">, 4,</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, c.index + 4,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lfoType</span>, [0, 2, <span class="s13">\lin</span>, 1, 0],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\freq</span>, [0.001, 0.5, <span class="s13">\exp</span>, 0.0, 0.5],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\lo</span>, [0.0, 1, <span class="s13">\lin</span>, 0, 0.06],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\hi</span>, [0.0, 1, <span class="s13">\lin</span>, 0, 0.9]</p>
<p class="p12"><span class="Apple-tab-span">	</span>],[</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, 0,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\bufNum</span>, b.bufnum,</p>
<p class="p12"> <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\posDev</span>, [0.001, 0.2, <span class="s13">\exp</span>, 0, 0.02],</p>
<p class="p12"> <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, [0.0, 2, <span class="s13">\lin</span>, 0, 0.5]</p>
<p class="p12"><span class="Apple-tab-span">	</span>]],</p>
<p class="p18"><span class="s2"><span class="Apple-converted-space"> <span class="Apple-tab-span">	</span></span></span>// 5 lfo synths are generated by the interface (synthdef name passed)</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>// but granulation Synth is passed directly as object</p>
<p class="p12"><span class="Apple-tab-span">	</span>synth: <span class="s13">\lfo</span>!5 ++ x</p>
<p class="p12">).gui(sliderPriority: <span class="s13">\synth</span>, playerPriority: <span class="s13">\synth</span>);<span class="Apple-converted-space"> </span></p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p23"><br></p>
<p class="p9"><b>Example 1d: <span class="Apple-converted-space">  </span>Buffer granulation Synth with demand rate ugens</b></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p18">// Repeated grain triggering within a synth can be defined by demand rate ugens,<span class="Apple-converted-space"> </span></p>
<p class="p18">// which is comfortable in connection with granular ugens.</p>
<p class="p11"><br></p>
<p class="p18">// E.g. with TGrains you can trigger parameters like grain duration, playback rate,<span class="Apple-converted-space"> </span></p>
<p class="p18">// position, panning and amp, single grains will keep their params if they overlap.</p>
<p class="p18">// (Note that in the below implementation changes of demand rate array fields will apply</p>
<p class="p18">// also not before the next call of those fields in the synth)</p>
<p class="p11"><br></p>
<p class="p18">// More refined per-grain control, e.g. per-grain filtering with filter parameter streams,</p>
<p class="p18">// can be done by using a multichannel trick, see Ex. 1e.</p>
<p class="p2"><br></p>
<p class="p12">(</p>
<p class="p18">// length of demand rate sequence, you might want to check larger sizes</p>
<p class="p18">// in connection with gui arg tryColumnNum &gt; 1</p>
<p class="p12"><span class="s17">~n</span> = 5;</p>
<p class="p11"><br></p>
<p class="p18">// posRate control range is widened by inventing two controls for<span class="Apple-converted-space"> </span></p>
<p class="p18">// mantissa and exponent, so posRate = 1 for init param pair<span class="Apple-converted-space"> </span></p>
<p class="p18">// posRateE = 0 and posRateM = 1</p>
<p class="p11"><br></p>
<p class="p20"><span class="s12">SynthDef</span><span class="s2">(</span><span class="s13">\gran_1d</span><span class="s2">, { </span>|out = 0, soundBuf, posLo = 0.1, posHi = 0.3,<span class="Apple-converted-space"> </span></p>
<p class="p20"><span class="Apple-tab-span">	</span>posRateE = 0, posRateM = 1, granDurMul = 1, rateMul = 1, panMul = 1, amp = 0.5, interp = 2|<span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s14">var</span> signal, bufDur, granDur, granGate, relGranDurs, pos, overlap, overlaps, overlapSeq,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pan, rate, relRates, rateSeq, posRate, granDurSeq;<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>// array args for demand rate sequencing, short form of NamedControl<span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>relGranDurs = <span class="s13">\relGranDurs</span>.kr(0.1!<span class="s17">~n</span>);</p>
<p class="p12"><span class="Apple-tab-span">	</span>relRates = <span class="s13">\relRates</span>.kr(1!<span class="s17">~n</span>);<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>overlaps = <span class="s13">\overlaps</span>.kr(1!<span class="s17">~n</span>);<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>// Dstutter (or Dunique) necessary as granDurSeq is polled twice: granGate and granDur</p>
<p class="p12"><span class="Apple-tab-span">	</span>granDurSeq = <span class="s12">Dstutter</span>(2, <span class="s12">Dseq</span>(relGranDurs, <span class="s15">inf</span>)); <span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>rateSeq = <span class="s12">Dseq</span>(relRates, <span class="s15">inf</span>);<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>overlapSeq = <span class="s12">Dseq</span>(overlaps, <span class="s15">inf</span>);<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>granGate = <span class="s12">TDuty</span>.ar(granDurSeq * granDurMul);<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>granDur = <span class="s12">Demand</span>.ar(granGate, 0, granDurSeq * granDurMul);</p>
<p class="p12"><span class="Apple-tab-span">	</span>rate = <span class="s12">Demand</span>.ar(granGate, 0, rateSeq) * rateMul;<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>pan = <span class="s12">Demand</span>.ar(granGate, 0, <span class="s12">Dseq</span>([1, -1], <span class="s15">inf</span>)) * 0.999 * panMul;<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>overlap = <span class="s12">Demand</span>.ar(granGate, 0, overlapSeq);</p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span>bufDur = <span class="s12">BufDur</span>.kr(soundBuf);</p>
<p class="p12"><span class="Apple-tab-span">	</span>posRate = 10 ** posRateE * posRateM;</p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span>pos = <span class="s12">Phasor</span>.ar(0, <span class="s12">BufRateScale</span>.kr(soundBuf) * posRate / (<span class="s12">SampleRate</span>.ir * bufDur), posLo, posHi);</p>
<p class="p12"><span class="Apple-tab-span">	</span>signal = <span class="s12">TGrains</span>.ar(2, granGate, soundBuf, rate, pos * bufDur, granDur * overlap, pan, 1, interp);</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s12">Out</span>.ar(out, signal * amp);<span class="Apple-converted-space"> </span></p>
<p class="p12">}</p>
<p class="p12">).add;<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p14">b = <span class="s12">Buffer</span>.read(s, <span class="s12">Platform</span>.userExtensionDir +/+ <span class="s16">"miSCellaneous"</span> +/+ <span class="s16">"Sounds"</span> +/+ <span class="s16">"kitchen_sounds_1.wav"</span>);</p>
<p class="p24">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p12">)</p>
<p class="p2"><br></p>
<p class="p12">(</p>
<p class="p18">// relGranDurs are multiplied with granDurMul, analogously relRates with rateMul.</p>
<p class="p18">// Changes of these params apply immediately in contrast to the array args<span class="Apple-converted-space"> </span></p>
<p class="p18">// used by demand rate ugens which are used with next demand.</p>
<p class="p11"><br></p>
<p class="p18">// check out moving a number of sliders of one array by using</p>
<p class="p18">// Shift, Alt + Shift and Ctrl + Shift, see VarGui help Ex. 1c.</p>
<p class="p11"><span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p12"><span class="s12">VarGui</span>(synthCtr: [</p>
<p class="p12"><span class="Apple-tab-span">	</span>soundBuf: b.bufnum,</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>posLo: [0, 1, <span class="s13">\lin</span>, 0, 0.1],</p>
<p class="p12"><span class="Apple-tab-span">	</span>posHi: [0, 1, <span class="s13">\lin</span>, 0, 0.9],</p>
<p class="p12"><span class="Apple-tab-span">	</span>posRateE: [-3, 4, <span class="s13">\lin</span>, -1, 0],</p>
<p class="p12"><span class="Apple-tab-span">	</span>posRateM: [0.1, 10, <span class="s13">\exp</span>, 0.01, 0.5],</p>
<p class="p11"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>// generating control specifications depending on index</p>
<p class="p12"><span class="Apple-tab-span">	</span>relGranDurs: { <span class="s14">|i|</span> [0.01, 0.1, <span class="s13">\lin</span>, 0, i * 0.005 + 0.02] } ! <span class="s17">~n</span>,</p>
<p class="p12"><span class="Apple-tab-span">	</span>granDurMul: [0.03, 2, <span class="s13">\lin</span>, 0, 0.25],</p>
<p class="p12"><span class="Apple-tab-span">	</span>overlaps: [0.1, 5, <span class="s13">\lin</span>, 0, 1.5] ! <span class="s17">~n</span>,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>relRates: { <span class="s14">|i|</span> [0.1, 1.5, <span class="s13">\lin</span>, 0, (5-i) * 0.1 + 0.5] } ! <span class="s17">~n</span>,</p>
<p class="p12"><span class="Apple-tab-span">	</span>rateMul: [0.1, 2, <span class="s13">\lin</span>, 0, 0.5],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>panMul: [0, 1, <span class="s13">\lin</span>, 0, 0.6],</p>
<p class="p12"><span class="Apple-tab-span">	</span>amp: [0.0, 3, <span class="s13">\lin</span>, 0, 2]</p>
<p class="p12">],</p>
<p class="p12"><span class="Apple-tab-span">	</span>synth: <span class="s13">\gran_1d</span></p>
<p class="p12">).gui(</p>
<p class="p12"><span class="Apple-tab-span">	</span>tryColumnNum: 1,</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>// color grouping for better overview</p>
<p class="p12"><span class="Apple-tab-span">	</span>synthColorGroups: (0..(<span class="s17">~n</span>*3+8)).clumps([1,4,<span class="s17">~n</span>+1,<span class="s17">~n</span>,<span class="s17">~n</span>+1,1,1]),<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>labelWidth: 90,</p>
<p class="p12"><span class="Apple-tab-span">	</span>sliderWidth: 280<span class="Apple-converted-space"> </span></p>
<p class="p12">);</p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p9"><b>Example 1e: <span class="Apple-converted-space">  </span>Buffer granulation Synth with per-grain effect processing</b></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p18">// TGrains and other granular ugens allow per-grain processing</p>
<p class="p18">// for a limited number of parameters (pos, rate etc.)</p>
<p class="p18">// Nevertheless it is possible to apply arbitrary effects with</p>
<p class="p18">// per-grain parameter changes, even if grains overlap.</p>
<p class="p18">// This can be achieved by defining the granulation output</p>
<p class="p18">// as a multichannel signal and appropriate triggering of fx parameters.</p>
<p class="p18">// The example is adapted from a recommendation of Julian Rohrhuber.</p>
<p class="p11"><br></p>
<p class="p18">// The method is elegant but also a bit tricky in terms of</p>
<p class="p18">// multichannel triggering and channel routing.</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p18">// the multichannel size and equivalently:</p>
<p class="p18">// the maximum number of overlapping grains that might get</p>
<p class="p18">// different fx parameters have to be fixed.</p>
<p class="p18">// For convenience of later L/R-spatialization we take an<span class="Apple-converted-space"> </span></p>
<p class="p18">// even number ~n = 2 * ~m</p>
<p class="p11"><br></p>
<p class="p12"><span class="s17">~m</span> = 5;<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="s17">~n</span> = 2 * <span class="s17">~m</span>;<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p20"><span class="s12">SynthDef</span><span class="s2">(</span><span class="s13">\gran_1e</span><span class="s2">, { </span>|out = 0, soundBuf, posLo = 0.1, posHi = 0.9,<span class="Apple-converted-space"> </span></p>
<p class="p20"><span class="Apple-tab-span">	</span>posRateE = 0, posRateM = 1, rate = 1, panMax = 0.8, bpRQ = 0.1, bpLo = 50, bpHi = 5000,</p>
<p class="p20"><span class="Apple-tab-span">	</span>amp = 1, bpFund = 100, overlap = 2, trigRate = 1, interp = 2|<span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s14">var</span> sig, sigL, sigR, bpFreq, chan, bpFreqSeqs, dUgen,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trig, trigs, bufDur, pos, posRate;<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>trig = <span class="s12">Impulse</span>.ar(trigRate);</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>// we need a multichannel trigger that steps through all consecutive channels</p>
<p class="p12"><span class="Apple-tab-span">	</span>trigs = { <span class="s14">|i|</span> <span class="s12">PulseDivider</span>.ar(trig, <span class="s17">~n</span>, <span class="s17">~n</span>-1-i) } ! <span class="s17">~n</span>;<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span>chan = <span class="s12">Demand</span>.ar(trig, 0, <span class="s12">Dseq</span>((0..<span class="s17">~n</span>-1), <span class="s15">inf</span>));<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>posRate = 10 ** posRateE * posRateM;</p>
<p class="p12"><span class="Apple-tab-span">	</span>bufDur = <span class="s12">BufDur</span>.kr(soundBuf);</p>
<p class="p12"><span class="Apple-tab-span">	</span>pos = <span class="s12">Phasor</span>.ar(0, <span class="s12">BufRateScale</span>.kr(soundBuf) * posRate * <span class="s12">SampleDur</span>.ir / bufDur, posLo, posHi);</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>sig = <span class="s12">TGrains</span>.ar(<span class="s17">~n</span>, trig, soundBuf, rate, pos * bufDur, overlap/trigRate,<span class="Apple-converted-space"> </span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// Panning convention is that from PanAz,</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// speakers should be from 0 to 2, but (orientation)</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// 1/n has to be substracted for n speakers.</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// If this isn't done correctly grains are spread onto more than one channel</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// and per-grain application of fxs fails.</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>chan.linlin(0, <span class="s17">~n</span>-1, -1/<span class="s17">~n</span>, (2*<span class="s17">~n</span> - 3)/<span class="s17">~n</span>), 1, interp);</p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span>dUgen = <span class="s12">Dwhite</span>(0.0, 1);</p>
<p class="p12"><span class="Apple-tab-span">	</span>sig = sig.collect { <span class="s14">|ch, i|</span><span class="Apple-converted-space"> </span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// this is the place to define fxs per channel/grain</p>
<p class="p18"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>// multichannel trigger is polling from a single demand ugen</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>bpFreq = <span class="s12">Demand</span>.ar(trigs[i], 0, dUgen).linlin(0, 1, bpLo, bpHi);<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// amplitude compensation for lower rq of bandpass filter</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s12">BPF</span>.ar(ch, bpFreq, bpRQ, (bpRQ ** -1) * (400 / bpFreq ** 0.5));<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>};</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>// routing to two channels ...</p>
<p class="p12"><span class="Apple-tab-span">	</span>sigL = <span class="s12">Mix</span>(((0..(<span class="s17">~m</span>-1)) * 2).collect(sig[<span class="s12">_</span>]));<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>sigR = <span class="s12">Mix</span>(((0..(<span class="s17">~m</span>-1)) * 2 + 1).collect(sig[<span class="s12">_</span>]));<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>// ... in order to have L/R-spreading with panMax as in other examples</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s12">Out</span>.ar(0, <span class="s12">Pan2</span>.ar(sigL, panMax.neg) + <span class="s12">Pan2</span>.ar(sigR, panMax) * amp)<span class="Apple-converted-space"> </span></p>
<p class="p12">}).add;</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p14">b = <span class="s12">Buffer</span>.read(s, <span class="s12">Platform</span>.userExtensionDir +/+ <span class="s16">"miSCellaneous"</span> +/+ <span class="s16">"Sounds"</span> +/+ <span class="s16">"kitchen_sounds_1.wav"</span>);</p>
<p class="p24">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p12">)<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p12"><span class="s12">VarGui</span>(synthCtr: [</p>
<p class="p12"><span class="Apple-tab-span">	</span>soundBuf: b.bufnum,</p>
<p class="p12"><span class="Apple-tab-span">	</span>posLo: [0, 1, <span class="s13">\lin</span>, 0, 0.2],</p>
<p class="p12"><span class="Apple-tab-span">	</span>posHi: [0, 1, <span class="s13">\lin</span>, 0, 0.5],</p>
<p class="p12"><span class="Apple-tab-span">	</span>posRateE: [-3, 4, <span class="s13">\lin</span>, -1, -1],</p>
<p class="p12"><span class="Apple-tab-span">	</span>posRateM: [0.1, 10, <span class="s13">\exp</span>, 0.01, 0.8],</p>
<p class="p12"><span class="Apple-tab-span">	</span>overlap: [0.1, <span class="s17">~n</span>, <span class="s13">\lin</span>, 0, 12],</p>
<p class="p12"><span class="Apple-tab-span">	</span>trigRate: [1, 100, <span class="s13">\lin</span>, 0, 45],</p>
<p class="p12"><span class="Apple-tab-span">	</span>rate: [0.1, 2, <span class="s13">\lin</span>, 0, 1],</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>bpRQ: [0.05, 1, <span class="s13">\lin</span>, 0, 0.25],</p>
<p class="p12"><span class="Apple-tab-span">	</span>bpLo: [50.0, 5000, <span class="s13">\exp</span>, 0, 50],</p>
<p class="p12"><span class="Apple-tab-span">	</span>bpHi: [50.0, 5000, <span class="s13">\exp</span>, 0, 5000],</p>
<p class="p12"><span class="Apple-tab-span">	</span>panMax: [0, 1, <span class="s13">\lin</span>, 0, 0.85],</p>
<p class="p12"><span class="Apple-tab-span">	</span>amp: [0.0, 3, <span class="s13">\lin</span>, 0, 1]</p>
<p class="p12">],</p>
<p class="p12"><span class="Apple-tab-span">	</span>synth: <span class="s13">\gran_1e</span></p>
<p class="p12">).gui(</p>
<p class="p12"><span class="Apple-tab-span">	</span>tryColumnNum: 1,</p>
<p class="p12"><span class="Apple-tab-span">	</span>synthColorGroups: (0..12).clumps([1,4,2,1,3,1,1])<span class="Apple-converted-space"> </span></p>
<p class="p12">);</p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p2"><br></p>
<p class="p9"><b><span class="s3">2.) Granulation driven by language</span></b></p>
<p class="p10"><br></p>
<p class="p9"><b>Example 2a: <span class="Apple-converted-space">  </span>Basic buffer granulation Pbind</b></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p13">// Control parameters like in 1a, but implemented with a SynthDef for</p>
<p class="p13">// playing single grains and an appropriate Pbind,</p>
<p class="p13">// OffsetOut used for exact timing.</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p25">SynthDef<span class="s2">(</span><span class="s10">\gran_2a</span><span class="s2">, { </span>|out = 0, pos = 0, sndBuf = 0, windowBuf = 1, granDur = 0.1,<span class="Apple-converted-space"> </span></p>
<p class="p25"><span class="Apple-tab-span">	</span>rate = 1, loop = 1, panMax = 0, amp = 1|<span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">var</span> window, src;</p>
<p class="p12"><span class="Apple-tab-span">	</span>src = <span class="s9">PlayBuf</span>.ar(1, sndBuf, <span class="s9">BufRateScale</span>.kr(sndBuf) * rate,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1, round(pos * <span class="s9">BufFrames</span>.kr(sndBuf)), loop, 2);</p>
<p class="p12"><span class="Apple-tab-span">	</span>window = <span class="s9">BufRd</span>.ar(1, windowBuf,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">EnvGen</span>.ar(<span class="s9">Env</span>([0, <span class="s9">BufFrames</span>.kr(windowBuf)], [granDur]),<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>doneAction: 2), loop, 4);<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">OffsetOut</span>.ar(out, <span class="s9">Pan2</span>.ar(src, panMax, amp) * window);<span class="Apple-converted-space"> </span></p>
<p class="p12">}).add;<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p16"><br></p>
<p class="p14">b = <span class="s9">Buffer</span>.read(s, <span class="s9">Platform</span>.userExtensionDir +/+ <span class="s11">"miSCellaneous"</span> +/+ <span class="s11">"Sounds"</span> +/+ <span class="s11">"kitchen_sounds_1.wav"</span>);</p>
<p class="p15">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p16"><br></p>
<p class="p12">w = <span class="s9">Buffer</span>.sendCollection(s, <span class="s9">Signal</span>.hanningWindow(1024));</p>
<p class="p12">)</p>
<p class="p17"><br></p>
<p class="p17"><br></p>
<p class="p15">// Determining the correct buffer position depending on</p>
<p class="p15">// posRate, posLo and posHi needs a little calculation.</p>
<p class="p15">// In 1a this was done inside the ugen by a Phasor.</p>
<p class="p15">// See Ex. 3b, 3c for doing position movement with a separate Synth.</p>
<p class="p16"><br></p>
<p class="p15">// PL placeholder patterns used, could also be Pfunc { ~ ... }</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p12">p = <span class="s9">Pbind</span>(<span class="Apple-converted-space"> </span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\gran_2a<span class="s2">,<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\sndBuf<span class="s2">, b,</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\windowBuf<span class="s2">, w,<span class="Apple-converted-space"> </span></span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, 1 / </span><span class="s9">PL</span><span class="s2">(</span>\trigRate<span class="s2">),<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\granDur<span class="s2">),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\time</span>, <span class="s9">Ptime</span>(),</p>
<p class="p25"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s10">\pos</span><span class="s2">, </span>Pfunc<span class="s2"> { </span>|e|</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">var</span> relTime = ~posRate * e.time / e.sndBuf.duration, relDif;</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>relDif = ~posHi - ~posLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>relTime + rand2(~posDev) % relDif + ~posLo;<span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>},</p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\rate<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\rate<span class="s2">), <span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\panMax</span>, <span class="s9">PLseq</span>([-1,1]) * <span class="s9">PL</span>(<span class="s10">\panMax</span>),</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\out</span>, 0</p>
<p class="p12">);</p>
<p class="p11"><br></p>
<p class="p25">VarGui<span class="s2">([</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posLo</span>, [0.0, 0.99, <span class="s10">\lin</span>, 0.01, 0],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posHi</span>, [0.0, 0.99, <span class="s10">\lin</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posRate</span>, [0.1, 2, <span class="s10">\lin</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posDev</span>, [0, 0.2, 5, 0, 0.01],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\trigRate</span>, [1, 200, <span class="s10">\lin</span>, 0.01, 120],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\granDur</span>, [0.01, 0.3, <span class="s10">\lin</span>, 0.005, 0.06],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\rate</span>, [0.1, 3, <span class="s10">\lin</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\panMax</span>, [0.0, 1, <span class="s10">\lin</span>, 0.0, 0.8],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\amp</span>, [0.0, 1, <span class="s10">\lin</span>, 0.01, 0.25]</p>
<p class="p12"><span class="Apple-tab-span">	</span>], stream: p</p>
<p class="p12">).gui(varColorGroups: (0..8).clumps([4,1,1,1,1,1]))<span class="Apple-tab-span">	</span></p>
<p class="p12">)</p>
<p class="p17"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p9"><b>Example 2b: <span class="Apple-converted-space">  </span>Switching between stochastic distributions</b></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p13">// Extended basic SynthDef from Ex.2a with bandpass filter</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p25">SynthDef<span class="s2">(</span><span class="s10">\gran_2b</span><span class="s2">, { </span>|out = 0, pos = 0, sndBuf = 0, windowBuf = 1, granDur = 0.1,<span class="Apple-converted-space"> </span></p>
<p class="p25"><span class="Apple-tab-span">	</span>rate = 1, loop = 1, panMax = 0, amp = 1, bpFreq = 500, bpRQ = 0.5, bpWet = 1|<span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">var</span> window, granSrc, src;</p>
<p class="p12"><span class="Apple-tab-span">	</span>granSrc = <span class="s9">PlayBuf</span>.ar(1, sndBuf, <span class="s9">BufRateScale</span>.kr(sndBuf) * rate,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1, round(pos * <span class="s9">BufFrames</span>.kr(sndBuf)), loop, 2);</p>
<p class="p12"><span class="Apple-tab-span">	</span>window = <span class="s9">BufRd</span>.ar(1, windowBuf,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">EnvGen</span>.ar(<span class="s9">Env</span>([0, <span class="s9">BufFrames</span>.kr(windowBuf)], [granDur]),<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>doneAction: 2), loop, 4);</p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span></span>// do amplitude compensation, estimation like in Wavesets example by Alberto de Campo<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>src = (<span class="s9">BPF</span>.ar(granSrc, bpFreq, bpRQ, mul: (bpRQ ** -1) * (400 / bpFreq ** 0.5)) *<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>bpWet + (granSrc * (1 - bpWet)));</p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">OffsetOut</span>.ar(out, <span class="s9">Pan2</span>.ar(src, panMax, amp) * window);<span class="Apple-converted-space"> </span></p>
<p class="p12">}).add;<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p14">b = <span class="s9">Buffer</span>.read(s, <span class="s9">Platform</span>.userExtensionDir +/+ <span class="s11">"miSCellaneous"</span> +/+ <span class="s11">"Sounds"</span> +/+ <span class="s11">"kitchen_sounds_1.wav"</span>);</p>
<p class="p15">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p16"><br></p>
<p class="p12">w = <span class="s9">Buffer</span>.sendCollection(s, <span class="s9">Signal</span>.hanningWindow(1024));</p>
<p class="p12">)</p>
<p class="p17"><br></p>
<p class="p11"><br></p>
<p class="p13">// random types</p>
<p class="p11"><br></p>
<p class="p13">// 0: low value</p>
<p class="p13">// 1: low or high value, evenly distributed</p>
<p class="p13">// 2: evenly distributed</p>
<p class="p13">// 3: linear decrease from mean value</p>
<p class="p13">// 4: exponential distribution</p>
<p class="p13">// 5: beta distribution, default parameter 0.3 centers value at the borders</p>
<p class="p13">// 6: brownian movement (of first order)<span class="Apple-converted-space"> </span></p>
<p class="p13">// 7: brownian movement of second order (stepsize itself generated by brownian movement)<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p13">// A second order brownian movement much more tends to get stuck at the</p>
<p class="p13">// borders than a normal (first order) brownian movement</p>
<p class="p13">// E.g. see Sergio Luque's presentation of Xenakis's stochastic synthesis:</p>
<p class="p13">// "Stochastic Synthesis, Origins and Extensions", pp 25-28<span class="Apple-converted-space"> </span></p>
<p class="p13">// http://sergioluque.com</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p15">// Function that generates an array of PLx patterns</p>
<p class="p15">// of different random types (see <a href="PLx suite.html"><span class="s18">PLx suite</span></a>).</p>
<p class="p15">// These placeholders can refer to environmental variables</p>
<p class="p15">// to be set by the VarGui interface later on.</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p25"><span class="s2">d = { </span>|keyLo, keyHi, betaProb = 0.3, brownStepFac = 0.01,</p>
<p class="p25"><span class="Apple-tab-span">	</span>brown2Ratio = 1, brown2StepFac = 0.01|</p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span></span>// keyLo and keyHi must be Symbols,</p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span></span>// other args may be Symbols</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">var</span> patLo, patHi, patDif;</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span></span>// avoid lo-hi reversing with Pbrown</p>
<p class="p12"><span class="Apple-tab-span">	</span>patLo = min(<span class="s9">PL</span>(keyLo), <span class="s9">PL</span>(keyHi));</p>
<p class="p12"><span class="Apple-tab-span">	</span>patHi = max(<span class="s9">PL</span>(keyLo), <span class="s9">PL</span>(keyHi));</p>
<p class="p12"><span class="Apple-tab-span">	</span>patDif = patHi - patLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span>[<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">PL</span>(keyLo),</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pfunc</span> { currentEnvironment[[keyLo, keyHi].choose] },</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">PLwhite</span>(keyLo, keyHi),</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">PLmeanrand</span>(keyLo, keyHi),</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">PLexprand</span>(keyLo, keyHi),<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">PLbeta</span>(keyLo, keyHi, betaProb, betaProb),<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">PLbrown</span>(patLo, patHi, patDif * <span class="s9">PL</span>(brownStepFac)),<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">PLbrown</span>(patLo, patHi,<span class="Apple-converted-space"> </span></p>
<p class="p25"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>PLbrown<span class="s2">(</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span>patDif.neg * <span class="s9">PL</span>(brown2Ratio) / 2,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span>patDif * <span class="s9">PL</span>(brown2Ratio) / 2,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    <span class="Apple-tab-span">	</span></span>patDif * <span class="s9">PL</span>(brown2Ratio) * <span class="s9">PL</span>(brown2StepFac)</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span>)</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>)<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>]</p>
<p class="p12">};</p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p13">// trigrate, granDur, rate and bpFreq are<span class="Apple-converted-space"> </span></p>
<p class="p13">// chosen between bounds according to the<span class="Apple-converted-space"> </span></p>
<p class="p13">// random distribution type notated with suffix D</p>
<p class="p11"><br></p>
<p class="p13">// single grains are filtered with a bandpass</p>
<p class="p13">// amount of effect controlled with bpWet</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p12">p = <span class="s9">Pbind</span>(<span class="Apple-converted-space"> </span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\gran_2b<span class="s2">,<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\sndBuf<span class="s2">, b,</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\windowBuf<span class="s2">, w,<span class="Apple-converted-space"> </span></span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, 1 / </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\trigRateLo<span class="s2">, </span>\trigRateHi<span class="s2">), </span>\trigRateD<span class="s2">),<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\granDurLo<span class="s2">, </span>\granDurHi<span class="s2">), </span>\granDurD<span class="s2">),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\time</span>, <span class="s9">Ptime</span>(),</p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\posRate<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\posRate<span class="s2">), <span class="Apple-converted-space"> </span></span></p>
<p class="p25"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s10">\pos</span><span class="s2">, </span>Pfunc<span class="s2"> { </span>|e|</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">var</span> relTime = ~posRate * e.time / e.sndBuf.duration, relDif;</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>relDif = ~posHi - ~posLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>relTime + rand2(~posDev) % relDif + ~posLo;<span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>},</p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\rate<span class="s2">, </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\rateLo<span class="s2">, </span>\rateHi<span class="s2">), </span>\rateD<span class="s2">),</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\bpFreq<span class="s2">, </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\bpFreqLo<span class="s2">, </span>\bpFreqHi<span class="s2">), </span>\bpFreqD<span class="s2">),</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\bpRQ<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\bpRQ<span class="s2">),</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\bpWet<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\bpWet<span class="s2">),</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\panMax</span>, <span class="s9">PLseq</span>([-1,1]) * <span class="s9">PL</span>(<span class="s10">\panMax</span>),</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\out</span>, 0</p>
<p class="p12">);</p>
<p class="p11"><br></p>
<p class="p25">VarGui<span class="s2">([</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posLo</span>, [0.0, 0.99, <span class="s10">\lin</span>, 0.01, 0.21],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posHi</span>, [0.0, 0.99, <span class="s10">\lin</span>, 0.01, 0.47],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posRate</span>, [0.1, 2, <span class="s10">\lin</span>, 0.01, 0.2],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posDev</span>, [0, 0.2, 5, 0, 0.002],</p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\trigRateLo</span>, [1, 200, <span class="s10">\lin</span>, 0.01, 21],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\trigRateHi</span>, [1, 200, <span class="s10">\lin</span>, 0.01, 155],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\trigRateD</span>, [0, 7, <span class="s10">\lin</span>, 1, 6],</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\granDurLo</span>, [0.01, 0.6, <span class="s10">\exp</span>, 0.0, 0.037],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\granDurHi</span>, [0.01, 0.6, <span class="s10">\exp</span>, 0.0, 0.4],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\granDurD</span>, [0, 7, <span class="s10">\lin</span>, 1, 6],</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\rateLo</span>, [0.1, 3, <span class="s10">\lin</span>, 0.01, 1.09],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\rateHi</span>, [0.1, 3, <span class="s10">\lin</span>, 0.01, 1.63],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\rateD</span>, [0, 7, <span class="s10">\lin</span>, 1, 1],</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpFreqLo</span>, [50, 10000, <span class="s10">\exp</span>, 0.1, 54],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpFreqHi</span>, [50, 10000, <span class="s10">\exp</span>, 0.1,8275],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpFreqD</span>, [0, 7, <span class="s10">\lin</span>, 1, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpRQ</span>, [0.01, 0.99, <span class="s10">\lin</span>, 0.0, 0.07],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpWet</span>, [0.0, 1, <span class="s10">\linear</span>, 0.0, 0.23],</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\panMax</span>, [0.0, 1, <span class="s10">\lin</span>, 0.0, 0.85],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\amp</span>, [0.0, 1, <span class="s10">\lin</span>, 0.01, 0.25]</p>
<p class="p12"><span class="Apple-tab-span">	</span>], stream: p</p>
<p class="p12">).gui(varColorGroups: (0..19).clumps([4,3,3,3,5,1,1]))</p>
<p class="p12">)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p9"><b>Example 2c: <span class="Apple-converted-space">  </span>Generating granular phrases with Pspawner</b></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p13">// This example needs SynthDef \gran_2b and Function d to be taken from Ex. 2b</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p14">b = <span class="s9">Buffer</span>.read(s, <span class="s9">Platform</span>.userExtensionDir +/+ <span class="s11">"miSCellaneous"</span> +/+ <span class="s11">"Sounds"</span> +/+ <span class="s11">"kitchen_sounds_1.wav"</span>);</p>
<p class="p15">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p16"><br></p>
<p class="p12">w = <span class="s9">Buffer</span>.sendCollection(s, <span class="s9">Signal</span>.hanningWindow(1024));</p>
<p class="p12">)</p>
<p class="p17"><br></p>
<p class="p13">// A simple form of Pspawner is used to generate phrases.</p>
<p class="p13">// Phrase length params are taken a bit roughly as sustain and<span class="Apple-converted-space"> </span></p>
<p class="p13">// rest times also depend on randomly varying grain lengths.</p>
<p class="p13">// spSustain controls medium sustain time (without grain length overhead)</p>
<p class="p13">// spLegato controls medium legato factor (disregarding reduction by grain length overhead)</p>
<p class="p13">// spDev is causing separate random deviation of spSustain and spLegato<span class="Apple-converted-space"> </span></p>
<p class="p13">// between 1/(1+spDev) and 1+spDev</p>
<p class="p11"><br></p>
<p class="p13">// random distribution switching is restricted here to</p>
<p class="p13">// types 6 and 7 (random walks of first and second order)</p>
<p class="p13">// to force individual sound qualities of phrases.</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p13">// declare var here as pattern is repeatedly evaluated from within the Pspawner,</p>
<p class="p13">// interpreter variable would be unsafe if running examples in parallel</p>
<p class="p11"><br></p>
<p class="p25">var<span class="s2"> p = </span>Pbind<span class="s2">(<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\gran_2b<span class="s2">,<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\sndBuf<span class="s2">, b,</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\windowBuf<span class="s2">, w,<span class="Apple-converted-space"> </span></span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, 1 / </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\trigRateLo<span class="s2">, </span>\trigRateHi<span class="s2">), </span>\trigRateD<span class="s2">),<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\granDurLo<span class="s2">, </span>\granDurHi<span class="s2">), </span>\granDurD<span class="s2">),<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\time</span>, <span class="s9">Ptime</span>(),</p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\posRate<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\posRate<span class="s2">), <span class="Apple-converted-space"> </span></span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span></span>// random timeOffset added with each spawning</p>
<p class="p25"><span class="s2"><span class="Apple-tab-span">	</span></span><span class="s10">\pos</span><span class="s2">, </span>Pfunc<span class="s2"> { </span>|e|</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">var</span> relTime = ~posRate * e.time / e.sndBuf.duration + e.timeOffset, relDif;</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>relDif = ~posHi - ~posLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>relTime + rand2(~posDev) % relDif + ~posLo;<span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>},</p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\rate<span class="s2">, </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\rateLo<span class="s2">, </span>\rateHi<span class="s2">), </span>\rateD<span class="s2">),</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\bpFreq<span class="s2">, </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\bpFreqLo<span class="s2">, </span>\bpFreqHi<span class="s2">), </span>\bpFreqD<span class="s2">),</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\bpRQ<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\bpRQ<span class="s2">),</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\bpWet<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\bpWet<span class="s2">),</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> </span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\panMax</span>, <span class="s9">PLseq</span>([-1,1]) * <span class="s9">PL</span>(<span class="s10">\panMax</span>),</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\out</span>, 0</p>
<p class="p12">);</p>
<p class="p11"><br></p>
<p class="p25"><span class="s2">q = </span>Pspawner<span class="s2">({ </span>|sp|</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">var</span> randomizer = { <span class="s9">|x|</span> <span class="s9">var</span> y = rand(x); 0.5.coin.if { 1 + y }{ 1 / (1 + y) } },</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sus, legato, delta;<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>loop {</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sus = ~spSustain * randomizer.(~spDev);</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>legato = ~spLegato * randomizer.(~spDev);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// take random offset for each phrase</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sp.par(<span class="s9">Pfindur</span>(sus, <span class="s9">Psetpre</span>(<span class="s10">\timeOffset</span>, 5.0.rand, p)));</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>delta = sus / (~spLegato * randomizer.(~spDev));</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sp.wait(delta)</p>
<p class="p12"><span class="Apple-tab-span">	</span>}</p>
<p class="p12">});</p>
<p class="p11"><br></p>
<p class="p25">VarGui<span class="s2">([</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posLo</span>, [0.0, 0.99, <span class="s10">\lin</span>, 0.01, 0.16],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posHi</span>, [0.0, 0.99, <span class="s10">\lin</span>, 0.01, 0.41],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posRate</span>, [0.1, 2, <span class="s10">\lin</span>, 0.01, 1.4],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posDev</span>, [0, 0.2, 5, 0, 0.0017],</p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\trigRateLo</span>, [1, 200, <span class="s10">\lin</span>, 0.01, 70],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\trigRateHi</span>, [1, 200, <span class="s10">\lin</span>, 0.01, 150],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\trigRateD</span>, [6, 7, <span class="s10">\lin</span>, 1, 7],</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\granDurLo</span>, [0.01, 0.6, <span class="s10">\exp</span>, 0.0, 0.02],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\granDurHi</span>, [0.01, 0.6, <span class="s10">\exp</span>, 0.0, 0.11],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\granDurD</span>, [6, 7, <span class="s10">\lin</span>, 1, 6],</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\rateLo</span>, [0.1, 3, <span class="s10">\lin</span>, 0.01, 0.2],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\rateHi</span>, [0.1, 3, <span class="s10">\lin</span>, 0.01, 1.86],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\rateD</span>, [6, 7, <span class="s10">\lin</span>, 1, 7],</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpFreqLo</span>, [50, 10000, <span class="s10">\exp</span>, 0.1, 67],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpFreqHi</span>, [50, 10000, <span class="s10">\exp</span>, 0.1, 5885],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpFreqD</span>, [6, 7, <span class="s10">\lin</span>, 1, 6],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpRQ</span>, [0.01, 0.99, <span class="s10">\lin</span>, 0.0, 0.17],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpWet</span>, [0.0, 1, <span class="s10">\linear</span>, 0.0, 0.38],</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\spSustain</span>, [0.2, 2, <span class="s10">\linear</span>, 0.0, 0.884],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\spLegato</span>, [0.6, 1.2, <span class="s10">\linear</span>, 0.0, 0.996],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\spDev</span>, [0.0, 1, <span class="s10">\linear</span>, 0.0, 0.41],</p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\panMax</span>, [0.0, 1, <span class="s10">\lin</span>, 0.0, 0.85],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\amp</span>, [0.0, 1, <span class="s10">\lin</span>, 0.01, 0.35]</p>
<p class="p12"><span class="Apple-tab-span">	</span>], stream: q</p>
<p class="p12">).gui(varColorGroups: (0..22).clumps([4,3,3,3,5,3,1,1]) )</p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p10"><br></p>
<p class="p11"><br></p>
<p class="p9"><b>Example 2d: <span class="Apple-converted-space">  </span>Wave sets</b></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p13">// For this example you need Alberto de Campo's Wavesets class<span class="Apple-converted-space"> </span></p>
<p class="p13">// (Quark extension, implementation following definitions of Trevor Wishart)</p>
<p class="p13">// and the Function d from Ex. 2b</p>
<p class="p11"><br></p>
<p class="p13">// the wave set player synth optionally adds a BPF applied to the signal,<span class="Apple-converted-space"> </span></p>
<p class="p13">// amount can be controlled with bpWet</p>
<p class="p13">// attack and release time &gt; 0 for smoothening</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p12"><span class="s9">SynthDef</span>(<span class="s10">\wsPlayer</span>, { <span class="s9">arg</span> out = 0, buf = 0, start = 0, length = 441,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>rate = 1, att = 0.03, rel = 0.03, wvDur = 1, panMax = 0, amp = 0.2,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>delayL = 0.0, delayR = 0.0, bpFreq = 500, bpRQ = 0.5, bpWet = 1;<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">var</span> phasor, env, granSrc, src, attEff, relEff, sus;</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>phasor = <span class="s9">Phasor</span>.ar(0, <span class="s9">BufRateScale</span>.ir(buf) * rate, 0, length) + start;</p>
<p class="p12"><span class="Apple-tab-span">	</span>attEff = min(att, wvDur/2);</p>
<p class="p12"><span class="Apple-tab-span">	</span>relEff = min(rel, wvDur/2);</p>
<p class="p12"><span class="Apple-tab-span">	</span>sus = wvDur - attEff - relEff;</p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span>env = <span class="s9">EnvGen</span>.ar(<span class="s9">Env</span>([0, 1, 1, 0], [attEff, sus, relEff], <span class="s10">\sine</span>), doneAction: 2);</p>
<p class="p12"><span class="Apple-tab-span">	</span>granSrc = <span class="s9">BufRd</span>.ar(1, buf, phasor);</p>
<p class="p12"><span class="Apple-tab-span">	</span>src = (<span class="s9">BPF</span>.ar(granSrc, bpFreq, bpRQ, mul: (bpRQ ** -1) * (400 / bpFreq ** 0.5)) *<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>bpWet + (granSrc * (1 - bpWet)));</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">OffsetOut</span>.ar(out, <span class="s9">Pan2</span>.ar(src, panMax, amp) * env);</p>
<p class="p12">}).add;</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p27"><span class="s2">a = </span><span class="s9">Platform</span><span class="s2">.userExtensionDir +/+ </span>"miSCellaneous"<span class="s2"> +/+ </span>"Sounds"<span class="s2"> +/+ </span>"kitchen_sounds_1.wav"<span class="s2">;</span></p>
<p class="p15">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p11"><br></p>
<p class="p14">b = <span class="s9">Buffer</span>.read(s, a);</p>
<p class="p12">w = <span class="s9">Wavesets</span>.from(a);</p>
<p class="p11"><br></p>
<p class="p13">// relative positions of zero crossings</p>
<p class="p12">x = w.fracXings.drop(-1) / w.numFrames;</p>
<p class="p12">)</p>
<p class="p17"><br></p>
<p class="p17"><br></p>
<p class="p13">// Note that trigRate / event duration is not controlled directly in this setup,</p>
<p class="p13">// it's derived from wave set length (may vary) and legato factor.<span class="Apple-converted-space"> </span></p>
<p class="p13">// For short wave sets and a low legato value durs could become so short that<span class="Apple-converted-space"> </span></p>
<p class="p13">// a sudden mass of grains could cause hangs.</p>
<p class="p13">// To avoid this a parameter maxTrigRate is invented.</p>
<p class="p11"><br></p>
<p class="p13">// As wavesets start at distinguished positions in the buffer and<span class="Apple-converted-space"> </span></p>
<p class="p13">// - together with legato - durations are determined,</p>
<p class="p13">// an additionally given position rate in general cannot result in a "correct"</p>
<p class="p13">// looping through the buffer, there will be a deviation.</p>
<p class="p13">// Here two types of approximation can be choosen with posType:</p>
<p class="p13">// Type 0 takes the waveset nearest to the calculated exact position.</p>
<p class="p13">// Type 1 linearly maps positions to wave set indices.</p>
<p class="p13">// As wave sets are of different length the latter is a rough heuristic</p>
<p class="p13">// accelerating buffer parts with relatively low frequencies.<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p14">(</p>
<p class="p12">p = <span class="s9">Pbind</span>(</p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\wsPlayer<span class="s2">,</span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span></span>// refering to interpreter variables within Pfuncs<span class="Apple-converted-space"> </span></p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span></span>// when running several examples in parallel is unsafe,</p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span></span>// so pass them here, then access from within the event</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\b</span>, b,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\w</span>, w,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\x</span>, x,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\time</span>, <span class="s9">Ptime</span>(),</p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\posLo<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\posLo<span class="s2">),</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\posHi<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\posHi<span class="s2">),</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\posRate<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\posRate<span class="s2">),</span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\pos</span>, <span class="s9">Pfunc</span> { <span class="s9">|e|</span> (e.time * e.posRate / e.b.duration) %<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(e.posHi - e.posLo) + e.posLo },</p>
<p class="p11"><br></p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span></span>// Estimation of ws index from relative position, see explanation above,</p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span></span>// indexIn might be a bottleneck with large buffers,</p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span></span>// also a more rough estimation of ws index could be used:</p>
<p class="p13"><span class="s2"><span class="Apple-tab-span">	</span></span>// \startWs, Pfunc { |e| e.pos.linlin(0, 1, 0, e.w.xings.size - 2).round.asInteger }</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\startWs<span class="s2">, </span><span class="s9">Pfunc</span><span class="s2"> { </span><span class="s9">|e|</span><span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(~posType == 0).if {</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>e.x.indexIn(e.pos)</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}{</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>e.pos.linlin(e.posLo, e.posHi, e.x.indexIn(e.posLo), e.x.indexIn(e.posHi))</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>.round.asInteger<span class="Apple-converted-space"> <span class="Apple-tab-span">	</span></span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>},</p>
<p class="p11"><br></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\numWs<span class="s2">, </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\numWsLo<span class="s2">, </span>\numWsHi<span class="s2">), </span>\numWsD<span class="s2">),</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\repeats<span class="s2">, </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\repeatsLo<span class="s2">, </span>\repeatsHi<span class="s2">), </span>\repeatsD<span class="s2">),</span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\bpFreq<span class="s2">, </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\bpFreqLo<span class="s2">, </span>\bpFreqHi<span class="s2">), </span>\bpFreqD<span class="s2">),</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\bpRQ<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\bpRQ<span class="s2">),</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\bpWet<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\bpWet<span class="s2">),</span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\rate<span class="s2">, </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\rateLo<span class="s2">, </span>\rateHi<span class="s2">), </span>\rateD<span class="s2">),</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\data</span>, <span class="s9">Pfunc</span> { <span class="s9">|e|</span> e.w.frameFor(e.startWs, e.numWs)<span class="Apple-converted-space">  </span>},</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\buf</span>, b.bufnum,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\start</span>, <span class="s9">Pkey</span>(<span class="s10">\data</span>).collect(<span class="s9">_</span>[0]), <span class="s19">// startFrame</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\length</span>, <span class="s9">Pkey</span>(<span class="s10">\data</span>).collect(<span class="s9">_</span>[1]), <span class="s19">// length (frameNum)</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\wvDur</span>, <span class="s9">Pkey</span>(<span class="s10">\data</span>).collect(<span class="s9">_</span>[2]) * <span class="s9">Pkey</span>(<span class="s10">\repeats</span>), <span class="s19">// sustain time</span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\calculatedDur<span class="s2">, </span><span class="s9">Pkey</span><span class="s2">(</span>\wvDur<span class="s2">) / </span><span class="s9">PLswitch1</span><span class="s2">(d.(</span>\legatoLo<span class="s2">, </span>\legatoHi<span class="s2">), </span>\legatoD<span class="s2">),</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\dur</span>, <span class="s9">Pfunc</span> { <span class="s9">|e|</span> max(e.calculatedDur, 1 / ~maxTrigRate) },</p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\panMax</span>, <span class="s9">PLseq</span>([-1,1]) * <span class="s9">PL</span>(<span class="s10">\panMax</span>),</p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\out</span>, 0</p>
<p class="p12">);</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p25">VarGui<span class="s2">([</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posLo</span>, [0, 1, <span class="s10">\lin</span>, 0.0, 0.15],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posHi</span>, [0, 1, <span class="s10">\lin</span>, 0.0, 0.45],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posRate</span>, [0.0, 2, <span class="s10">\lin</span>, 0.01, 0.25],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\posType</span>, [0, 1, <span class="s10">\lin</span>, 1, 0],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\numWsLo</span>, [1, 100, <span class="s10">\lin</span>, 1, 5],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\numWsHi</span>, [1, 100, <span class="s10">\lin</span>, 1, 23],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\numWsD</span>, [0, 7, <span class="s10">\lin</span>, 1, 6],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\repeatsLo</span>, [1, 4, <span class="s10">\lin</span>, 1, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\repeatsHi</span>, [1, 4, <span class="s10">\lin</span>, 1, 2],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\repeatsD</span>, [0, 7, <span class="s10">\lin</span>, 1, 6],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\maxTrigRate</span>, [1, 250, <span class="s10">\lin</span>, 1, 200],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpFreqLo</span>, [50, 10000, <span class="s10">\exp</span>, 0.1, 67],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpFreqHi</span>, [50, 10000, <span class="s10">\exp</span>, 0.1, 9600],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpFreqD</span>, [0, 7, <span class="s10">\lin</span>, 1, 7],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpRQ</span>, [0.01, 0.99, <span class="s10">\lin</span>, 0.005, 0.22],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\bpWet</span>, [0.0, 1, <span class="s10">\lin</span>, 0.005, 0.0],</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\rateLo</span>, [0.05, 2, <span class="s10">\lin</span>, 0.0, 0.32],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\rateHi</span>, [0.05, 2, <span class="s10">\lin</span>, 0.0, 1.3],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\rateD</span>, [0, 7, <span class="s10">\lin</span>, 1, 7],</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\att</span>, [0.0, 0.05, <span class="s10">\lin</span>, 0.001, 0.001], <span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\rel</span>, [0.0, 0.05, <span class="s10">\lin</span>, 0.001, 0.001],<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\panMax</span>, [0.0, 1, <span class="s10">\lin</span>, 0, 0.8],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\legatoLo</span>, [0.3, 25, <span class="s10">\exp</span>, 0, 0.4],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\legatoHi</span>, [0.3, 25, <span class="s10">\exp</span>, 0, 5.5],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\legatoD</span>, [0, 7, <span class="s10">\lin</span>, 1, 7],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\amp</span>, [0.0, 2.0, <span class="s10">\lin</span>, 0.0, 0.7] <span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>stream: p</p>
<p class="p12">).gui(varColorGroups: (0..25).clumps([4,3,3,1,5,3,2,1,3,1]))</p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p10"><br></p>
<p class="p2"><br></p>
<p class="p9"><b><span class="s3">3.) Hybrid Implementations</span></b></p>
<p class="p10"><br></p>
<p class="p9"><b>Example 3a: <span class="Apple-converted-space">  </span>Granulation with ugen plus step sequencing</b></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p13">// Here the trigger for the TGrains ugen comes from a Pbind</p>
<p class="p13">// which also generates rates like a step sequencer</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p12"><span class="s9">SynthDef</span>(<span class="s10">\gran_3a</span>, { <span class="s9">arg</span> out = 0, posLo = 0.0, posHi = 1.0,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>posRate = 1, posDev = 0.01, bufNum = 0, t_trig = 0,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>granDur = 0.1, t_rate = 1.0, rateDev = 0,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>panMax = 1, amp = 0.1, interp = 4;</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">var</span> pan, pos, bufDur, bufDurSection, posDif;</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>posDif = posHi - posLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span>bufDur = <span class="s9">BufDur</span>.kr(bufNum);</p>
<p class="p12"><span class="Apple-tab-span">	</span>bufDurSection = bufDur * posDif;<span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>pos = posLo * bufDur +</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(<span class="s9">Phasor</span>.ar(0, <span class="s9">BufRateScale</span>.kr(bufNum) * posRate / <span class="s9">SampleRate</span>.ir, posLo * bufDur, posHi * bufDur) +<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(<span class="s9">TRand</span>.kr(-0.5, 0.5, t_trig) * posDev * bufDur)).mod(bufDurSection); <span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>pan = <span class="s9">Demand</span>.kr(t_trig, 0, <span class="s9">Dseq</span>([panMax, panMax.neg], <span class="s9">inf</span>) * 0.999);</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">Out</span>.ar(out, <span class="s9">TGrains</span>.ar(2, t_trig, bufNum, t_rate, pos, granDur, pan, amp, interp));</p>
<p class="p12"><span class="Apple-tab-span">	</span>}, metadata: (</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>specs: (</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posLo: [0.01, 0.99, <span class="s10">\lin</span>, 0.01, 0.2],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posHi: [0.01, 0.99, <span class="s10">\lin</span>, 0.01, 0.75],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posRate: [0.1, 2, <span class="s10">\lin</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>posDev: [0, 0.2, 5, 0, 0.01],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>panMax: [0.0, 1, <span class="s10">\lin</span>, 0.005, 0.8],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>amp: [0.0, 1, <span class="s10">\lin</span>, 0.005, 0.5]</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>)</p>
<p class="p12"><span class="Apple-tab-span">	</span>)</p>
<p class="p12">).add;</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p16"><br></p>
<p class="p14">b = <span class="s9">Buffer</span>.read(s, <span class="s9">Platform</span>.userExtensionDir +/+ <span class="s11">"miSCellaneous"</span> +/+ <span class="s11">"Sounds"</span> +/+ <span class="s11">"kitchen_sounds_1.wav"</span>);</p>
<p class="p15">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p12">)</p>
<p class="p16"><br></p>
<p class="p16"><br></p>
<p class="p15">// As the setting Pbind needs to know the Synth's nodeID</p>
<p class="p15">// the Synth has to be started explicitely and passed to the VarGui later on</p>
<p class="p15">// (VarGui takes Synths as well as SynthDefs, passing a SynthDef is recommended in general).</p>
<p class="p15">// The Synth starts silently as t_trig defaults to 0.</p>
<p class="p16"><br></p>
<p class="p16"><br></p>
<p class="p14">(</p>
<p class="p14">x = <span class="s9">Synth</span>(<span class="s10">\gran_3a</span>, [<span class="s10">\bufNum</span>, b]).register;</p>
<p class="p16"><br></p>
<p class="p14">p = <span class="s9">Pbind</span>(</p>
<p class="p28"><span class="s2"><span class="Apple-tab-span">	</span></span>\type<span class="s2">, </span>\set<span class="s2">,</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="s10">\id</span>, x,</p>
<p class="p28"><span class="s2"><span class="Apple-tab-span">	</span></span>\args<span class="s2">, [</span>\t_trig<span class="s2">, </span>\t_rate<span class="s2">, </span>\granDur<span class="s2">],</span></p>
<p class="p16"><span class="Apple-tab-span">	</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\dur<span class="s2">),</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, </span><span class="s9">Pkey</span><span class="s2">(</span>\dur<span class="s2">) * </span><span class="s9">PL</span><span class="s2">(</span>\legato<span class="s2">),</span></p>
<p class="p28"><span class="s2"><span class="Apple-tab-span">	</span></span>\t_trig<span class="s2">, 1,</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="s10">\t_rate</span>, <span class="s9">PLseq</span>(<span class="s10">\midi</span>).midiratio</p>
<p class="p14">);</p>
<p class="p29">)</p>
<p class="p30"><br></p>
<p class="p31"><br></p>
<p class="p15">// Do start and pause with the Pbind (EventStreamPlayer) player.</p>
<p class="p15">// If you stop the Synth you cannot resume audio with a new Synth</p>
<p class="p15">// as the EventStreamPlayer has lost the correct nodeID</p>
<p class="p15">// (however the Synth can be paused and resumed).</p>
<p class="p30"><br></p>
<p class="p11"><br></p>
<p class="p25">(</p>
<p class="p12"><span class="s9">VarGui</span>(varCtr: [</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\dur</span>, [0.01, 0.1, <span class="s10">\lin</span>, 0, 0.05],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\legato</span>, [0.3, 3, <span class="s10">\lin</span>, 0, 2],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\midi</span>, [-12, 12, <span class="s10">\lin</span>, 1, 1] ! 8<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>], synth: x, stream: p</p>
<p class="p12">).gui;</p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p9"><b>Example 3b: <span class="Apple-converted-space">  </span>Using external control synths</b></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p13">// Example needs SynthDef from Ex. 2a</p>
<p class="p11"><br></p>
<p class="p13">// Also with language-driven granulation<span class="Apple-converted-space"> </span></p>
<p class="p13">// controls can be delegated to separate Synths,</p>
<p class="p13">// which output to control busses.</p>
<p class="p13">// Control inputs of single synths can read from</p>
<p class="p13">// these busses (comfortably use aBus.asMap in the Pbind)</p>
<p class="p13">// or synths can read from busses with In.kr (needs extra definition).</p>
<p class="p11"><br></p>
<p class="p13">// A nearby parameter to determine with a separate synth is grain position</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p25">SynthDef<span class="s2">(</span><span class="s10">\bufPhasor</span><span class="s2">, { </span>|out = 0, sndBuf = 0, posRate = 1, posLo = 0, posHi = 1, posDev = 0.01|<span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">var</span> pos, posDif;</p>
<p class="p12"><span class="Apple-tab-span">	</span>posDif = posHi - posLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span>pos = <span class="s9">Phasor</span>.ar(1, posRate * <span class="s9">BufRateScale</span>.kr(sndBuf) / <span class="s9">BufFrames</span>.kr(sndBuf), 0, posDif)<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>+ <span class="s9">WhiteNoise</span>.kr(posDev / 2) % posDif + posLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">Out</span>.kr(out, <span class="s9">A2K</span>.kr(pos));<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>}<span class="Apple-converted-space"> </span></p>
<p class="p12">).add;<span class="Apple-converted-space"> </span></p>
<p class="p16"><br></p>
<p class="p14">b = <span class="s9">Buffer</span>.read(s, <span class="s9">Platform</span>.userExtensionDir +/+ <span class="s11">"miSCellaneous"</span> +/+ <span class="s11">"Sounds"</span> +/+ <span class="s11">"kitchen_sounds_1.wav"</span>);</p>
<p class="p15">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p16"><br></p>
<p class="p12">w = <span class="s9">Buffer</span>.sendCollection(s, <span class="s9">Signal</span>.hanningWindow(1024));</p>
<p class="p12">c = <span class="s9">Bus</span>.control(s,1);</p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p15">// in GUI start EventStreamPlayer and bufPhasor Synth</p>
<p class="p16"><br></p>
<p class="p12">(</p>
<p class="p12">p = <span class="s9">Pbind</span>(<span class="Apple-converted-space"> </span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\gran_2a<span class="s2">,<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\sndBuf<span class="s2">, b,</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\windowBuf<span class="s2">, w,<span class="Apple-converted-space"> </span></span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, 1 / </span><span class="s9">PL</span><span class="s2">(</span>\trigRate<span class="s2">),<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\granDur<span class="s2">),<span class="Apple-converted-space"> </span></span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\pos</span>, c.asMap,</p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\rate<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\rate<span class="s2">), <span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\panMax</span>, <span class="s9">PLseq</span>([-1,1]) * <span class="s9">PL</span>(<span class="s10">\panMax</span>),</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\out</span>, 0</p>
<p class="p12">);</p>
<p class="p11"><br></p>
<p class="p25">VarGui<span class="s2">([</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\trigRate</span>, [1, 200, <span class="s10">\lin</span>, 0.01, 50],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\granDur</span>, [0.01, 0.3, <span class="s10">\lin</span>, 0.005, 0.12],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\rate</span>, [0.1, 3, <span class="s10">\lin</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\panMax</span>, [0.0, 1, <span class="s10">\lin</span>, 0.0, 0.8],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\amp</span>, [0.0, 1, <span class="s10">\lin</span>, 0.01, 0.3]</p>
<p class="p12"><span class="Apple-tab-span">	</span>],[</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\out</span>, c.index,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\sndBuf</span>, b.bufnum,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\posLo</span>, [0, 1, <span class="s10">\linear</span>, 0.005, 0],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\posHi</span>, [0, 1, <span class="s10">\linear</span>, 0.005, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\posRate</span>, [0.1, 2, <span class="s10">\linear</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\posDev</span>, [0, 0.2, 5, 0, 0.01]</p>
<p class="p12"><span class="Apple-tab-span">	</span>],<span class="Apple-converted-space"> </span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span>p, </span>\bufPhasor</p>
<p class="p12">).gui(sliderPriority: <span class="s10">\synth</span>, playerPriority: <span class="s10">\synth</span>);<span class="Apple-tab-span">	</span></p>
<p class="p12">)</p>
<p class="p17"><br></p>
<p class="p10"><br></p>
<p class="p10"><br></p>
<p class="p9"><b>Example 3c: <span class="Apple-converted-space">  </span>Switching between ugens of external control synths</b></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p13">// Example needs SynthDef from Ex. 2a</p>
<p class="p11"><br></p>
<p class="p13">// external control synth for position as in 3a, but with<span class="Apple-converted-space"> </span></p>
<p class="p13">// different types of movement to select</p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p25">SynthDef<span class="s2">(</span><span class="s10">\bufPosLFO</span><span class="s2">, { </span>|out = 0, lfoType = 0, freq = 1, posLo = 0, posHi = 1, posDev = 0.01|<span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">var</span> pos, posDif;</p>
<p class="p12"><span class="Apple-tab-span">	</span>posDif = posHi - posLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span>pos = <span class="s9">WhiteNoise</span>.kr(posDev / 2) + <span class="s9">Select</span>.kr(lfoType,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[<span class="s9">LFDNoise0</span>, <span class="s9">LFDNoise1</span>, <span class="s9">LFDNoise3</span>].collect(<span class="s9">_</span>.kr(freq, posDif))) % posDif + posLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s9">Out</span>.kr(out, pos);<span class="Apple-converted-space"> </span></p>
<p class="p12">}).add;<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p14">b = <span class="s9">Buffer</span>.read(s, <span class="s9">Platform</span>.userExtensionDir +/+ <span class="s11">"miSCellaneous"</span> +/+ <span class="s11">"Sounds"</span> +/+ <span class="s11">"kitchen_sounds_1.wav"</span>);</p>
<p class="p15">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p16"><br></p>
<p class="p12">w = <span class="s9">Buffer</span>.sendCollection(s, <span class="s9">Signal</span>.hanningWindow(1024));</p>
<p class="p12">c = <span class="s9">Bus</span>.control(s,1);</p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p15">// added parallel grains</p>
<p class="p15">// in GUI start bufPhasor Synth before or together with EventStreamPlayer</p>
<p class="p16"><br></p>
<p class="p15">// buffer position movement can be forward and backward</p>
<p class="p15">// lfoType 0: LFDNoise0 (jumps)</p>
<p class="p15">// lfoType 1: LFDNoise1 (linear interpolation)</p>
<p class="p15">// lfoType 2: LFDNoise3 (cubic interpolation, smooth, useful in many control contexts)</p>
<p class="p16"><span class="Apple-converted-space"> </span></p>
<p class="p12">(</p>
<p class="p12">p = <span class="s9">Pbind</span>(<span class="Apple-converted-space"> </span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\gran_2a<span class="s2">,<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\sndBuf<span class="s2">, b,</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\windowBuf<span class="s2">, w,<span class="Apple-converted-space"> </span></span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, 1 / </span><span class="s9">PL</span><span class="s2">(</span>\trigRate<span class="s2">),<span class="Apple-converted-space"> </span></span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\granDur<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\granDur<span class="s2">),<span class="Apple-converted-space"> </span></span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\pos</span>, c.asMap,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\rate</span>, <span class="s9">PL</span>(<span class="s10">\rate</span>) * <span class="s9">PL</span>(<span class="s10">\midiAdd</span>).midiratio,</p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s9">PL</span><span class="s2">(</span>\amp<span class="s2">),</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\panMax</span>, <span class="s9">PLseq</span>([-1,1]) * <span class="s9">PL</span>(<span class="s10">\panMax</span>),</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s10">\out</span>, 0</p>
<p class="p12">);</p>
<p class="p11"><br></p>
<p class="p25">VarGui<span class="s2">([</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\trigRate</span>, [1, 200, <span class="s10">\lin</span>, 0.01, 80],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\granDur</span>, [0.01, 0.3, <span class="s10">\lin</span>, 0.005, 0.195],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\rate</span>, [0.1, 1.5, <span class="s10">\lin</span>, 0.01, 0.6],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\midiAdd</span>, [-5, 0].collect([-12, 12, <span class="s10">\lin</span>, 1, <span class="s20">_</span>]),</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\panMax</span>, [0.0, 1, <span class="s10">\lin</span>, 0.0, 0.95],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\amp</span>, [0.0, 1, <span class="s10">\lin</span>, 0.01, 0.15]</p>
<p class="p12"><span class="Apple-tab-span">	</span>],[</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\out</span>, c.index,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\posLo</span>, [0, 1, <span class="s10">\linear</span>, 0.005, 0.15],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\posHi</span>, [0, 1, <span class="s10">\linear</span>, 0.005, 0.43],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\posDev</span>, [0, 0.2, 5, 0, 0.0],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\freq</span>, [0.01, 2, <span class="s10">\lin</span>, 0, 0.96],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s10">\lfoType</span>, [0, 2, <span class="s10">\lin</span>, 1, 2]</p>
<p class="p12"><span class="Apple-tab-span">	</span>],<span class="Apple-converted-space"> </span></p>
<p class="p26"><span class="s2"><span class="Apple-tab-span">	</span>p, </span>\bufPosLFO</p>
<p class="p12">).gui(sliderPriority: <span class="s10">\synth</span>, playerPriority: <span class="s10">\synth</span>);<span class="Apple-tab-span">	</span></p>
<p class="p12">)</p>
<p class="p10"><br></p>
<p class="p11"><br></p>
<p class="p2"><br></p>
<p class="p9"><b>Example 3d: <span class="Apple-converted-space">  </span>Pattern-driven sequencing of granular events using demand rate ugens</b></p>
<p class="p23"><br></p>
<p class="p18">// This is basically the same as SynthDef \gran_1d with an additional envelope,</p>
<p class="p18">// grain position phasor is left out, position is determined by a phasor synth via bus and mapping.</p>
<p class="p32"><br></p>
<p class="p12">(</p>
<p class="p18">// length of demand rate sequence, you might want to check larger sizes</p>
<p class="p18">// in connection with gui arg tryColumnNum &gt; 1</p>
<p class="p12"><span class="s17">~n</span> = 5;</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p20"><span class="s12">SynthDef</span><span class="s2">(</span><span class="s13">\gran_3d</span><span class="s2">, { </span>|out = 0, soundBuf, envBuf, att = 0.1, sus = 1, rel = 1, pos = 0.5,</p>
<p class="p20"><span class="Apple-tab-span">	</span>granDurMul = 1, rateMul = 1, overlapMul = 1, panMul = 1, amp = 0.5, interp = 2|<span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s14">var</span> signal, bufDur, granDur, granGate, relGranDurs, overlap, relOverlaps, overlapSeq,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pan, rate, relRates, rateSeq, granDurSeq;<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>// array args for demand rate sequencing, short form of NamedControl<span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>relGranDurs = <span class="s13">\relGranDurs</span>.kr(0.1!<span class="s17">~n</span>);</p>
<p class="p12"><span class="Apple-tab-span">	</span>relRates = <span class="s13">\relRates</span>.kr(1!<span class="s17">~n</span>);<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>relOverlaps = <span class="s13">\relOverlaps</span>.kr(1!<span class="s17">~n</span>);<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>// Dstutter (or Dunique) necessary as granDurSeq is polled twice: granGate and granDur</p>
<p class="p12"><span class="Apple-tab-span">	</span>granDurSeq = <span class="s12">Dstutter</span>(2, <span class="s12">Dseq</span>(relGranDurs, <span class="s15">inf</span>)); <span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>rateSeq = <span class="s12">Dseq</span>(relRates, <span class="s15">inf</span>);<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>overlapSeq = <span class="s12">Dseq</span>(relOverlaps, <span class="s15">inf</span>);<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span>granGate = <span class="s12">TDuty</span>.ar(granDurSeq * granDurMul);<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>granDur = <span class="s12">Demand</span>.ar(granGate, 0, granDurSeq * granDurMul);</p>
<p class="p12"><span class="Apple-tab-span">	</span>rate = <span class="s12">Demand</span>.ar(granGate, 0, rateSeq) * rateMul;<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>pan = <span class="s12">Demand</span>.ar(granGate, 0, <span class="s12">Dseq</span>([1, -1], <span class="s15">inf</span>)) * 0.999 * panMul;<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>overlap = <span class="s12">Demand</span>.ar(granGate, 0, overlapSeq) * overlapMul;</p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span>bufDur = <span class="s12">BufDur</span>.kr(soundBuf);</p>
<p class="p12"><span class="Apple-tab-span">	</span>signal = <span class="s12">TGrains</span>.ar(2, granGate, soundBuf, rate, pos * bufDur, granDur * overlap, pan, 1, interp) *</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s12">EnvGen</span>.kr(<span class="s12">Env</span>([0, 1, 1, 0], [att, sus, rel]), doneAction: 2);</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s12">Out</span>.ar(out, signal * amp);<span class="Apple-converted-space"> </span></p>
<p class="p12">}</p>
<p class="p12">).add;<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p20"><span class="s12">SynthDef</span><span class="s2">(</span><span class="s13">\bufPhasor_2</span><span class="s2">, { </span>|out = 0, sndBuf = 0, posRateE = 0, posRateM = 1,<span class="Apple-converted-space"> </span></p>
<p class="p20"><span class="Apple-tab-span">	</span>posLo = 0, posHi = 1, posDev = 0.01|<span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s14">var</span> pos, posDif, posRate;</p>
<p class="p12"><span class="Apple-tab-span">	</span>posDif = posHi - posLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span>posRate = 10 ** posRateE * posRateM;</p>
<p class="p12"><span class="Apple-tab-span">	</span>pos = <span class="s12">Phasor</span>.ar(1, posRate * <span class="s12">BufRateScale</span>.kr(sndBuf) / <span class="s12">BufFrames</span>.kr(sndBuf), 0, posDif)<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>+ <span class="s12">WhiteNoise</span>.kr(posDev / 2) % posDif + posLo;</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s12">Out</span>.kr(out, <span class="s12">A2K</span>.kr(pos));<span class="Apple-converted-space"> </span></p>
<p class="p12">}<span class="Apple-converted-space"> </span></p>
<p class="p12">).add;<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p14">b = <span class="s12">Buffer</span>.read(s, <span class="s12">Platform</span>.userExtensionDir +/+ <span class="s16">"miSCellaneous"</span> +/+ <span class="s16">"Sounds"</span> +/+ <span class="s16">"kitchen_sounds_1.wav"</span>);</p>
<p class="p24">// maybe you need to use Platform.systemExtensionDir instead</p>
<p class="p11"><br></p>
<p class="p12">c = Bus.control(s,1);</p>
<p class="p12">)</p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p18">// Pattern control of granular events</p>
<p class="p19"><br></p>
<p class="p18">// Every granular event gets a duration between durLo and durHi (exp distribution)</p>
<p class="p18">// and an envelope according to att, sus and rel.</p>
<p class="p18">// One of four events is randomly defined as rest.<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p18">// arg arrays relGranDurs, relRates and relOverlaps determine</p>
<p class="p18">// demand rate sequencing for granulation as in Ex. 1d.</p>
<p class="p18">// Per event they are multiplied with corresponding factors</p>
<p class="p18">// limited by granDurMulLo/Hi, rateMulLo/Hi and overlapMulLo/Hi</p>
<p class="p11"><br></p>
<p class="p18">// start phasor synth (first row in player console) before event stream player</p>
<p class="p18">// event stream player might start with rest<span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p12">(</p>
<p class="p18">// Passing arrayed args with an event pattern requires</p>
<p class="p18">// wrapping them into an array or Ref object.</p>
<p class="p18">// This is necessary to distinguish from triggering<span class="Apple-converted-space"> </span></p>
<p class="p18">// several synths per event.</p>
<p class="p18">// .collect(`_) is short for .collect { |x| Ref(x) }</p>
<p class="p18">// .collect([_]) or .collect { |x| [x] } would also be possible</p>
<p class="p11"><br></p>
<p class="p12">p = <span class="s12">Pbind</span>(</p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\instrument<span class="s2">, </span>\gran_3d<span class="s2">,</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\soundBuf<span class="s2">, b,</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="s13">\pos</span>, c.asMap,</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\dur<span class="s2">, </span><span class="s12">PLexprand</span><span class="s2">(</span>\durLo<span class="s2">, </span>\durHi<span class="s2">),</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\type<span class="s2">, </span><span class="s12">PLshufn</span><span class="s2">(</span>\note<span class="s2">!3 ++ </span>\rest<span class="s2">),</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\att<span class="s2">, </span><span class="s12">PL</span><span class="s2">(</span>\att<span class="s2">),</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\sus<span class="s2">, </span><span class="s12">PL</span><span class="s2">(</span>\sus<span class="s2">),</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\rel<span class="s2">, </span><span class="s12">PL</span><span class="s2">(</span>\rel<span class="s2">),</span></p>
<p class="p11"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\relGranDurs<span class="s2">, </span><span class="s12">PL</span><span class="s2">(</span>\relGranDurs<span class="s2">).collect(`</span><span class="s12">_</span><span class="s2">),</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\granDurMul<span class="s2">, </span><span class="s12">PLwhite</span><span class="s2">(</span>\granDurMulLo<span class="s2">, </span>\granDurMulHi<span class="s2">),</span></p>
<p class="p11"><br></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\relOverlaps<span class="s2">, </span><span class="s12">PL</span><span class="s2">(</span>\relOverlaps<span class="s2">).collect(`</span><span class="s12">_</span><span class="s2">),</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\overlapMul<span class="s2">, </span><span class="s12">PLwhite</span><span class="s2">(</span>\overlapMulLo<span class="s2">, </span>\overlapMulHi<span class="s2">),</span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\relRates<span class="s2">, </span><span class="s12">PL</span><span class="s2">(</span>\relRates<span class="s2">).collect(`</span><span class="s12">_</span><span class="s2">),</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\rateMul<span class="s2">, </span><span class="s12">PLwhite</span><span class="s2">(</span>\rateMulLo<span class="s2">, </span>\rateMulHi<span class="s2">),</span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\panMul<span class="s2">, </span><span class="s12">PL</span><span class="s2">(</span>\panMul<span class="s2">),</span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span></span>\amp<span class="s2">, </span><span class="s12">PL</span><span class="s2">(</span>\amp<span class="s2">)</span></p>
<p class="p12">);</p>
<p class="p11"><br></p>
<p class="p21">VarGui<span class="s2">([</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\durLo</span>, [0.05, 1.5, <span class="s13">\lin</span>, 0, 0.16],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\durHi</span>, [0.05, 1.5, <span class="s13">\lin</span>, 0, 1.2],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\att</span>, [0.01, 0.6, <span class="s13">\lin</span>, 0, 0.4],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\sus</span>, [0.01, 0.6, <span class="s13">\lin</span>, 0, 0.05],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rel</span>, [0.01, 0.6, <span class="s13">\lin</span>, 0, 0.5],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\relGranDurs</span>, { <span class="s14">|i|</span> [0.01, 0.1, <span class="s13">\lin</span>, 0, i * 0.005 + 0.02] } ! <span class="s17">~n</span>,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\granDurMulLo</span>, [0.03, 2, <span class="s13">\lin</span>, 0, 0.05],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\granDurMulHi</span>, [0.03, 2, <span class="s13">\lin</span>, 0, 1.8],<span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\relRates</span>, { <span class="s14">|i|</span> [0.1, 1.5, <span class="s13">\lin</span>, 0, (5-i) * 0.1 + 0.5] } ! <span class="s17">~n</span>,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rateMulLo</span>, [0.1, 2, <span class="s13">\lin</span>, 0, 0.5],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\rateMulHi</span>, [0.1, 2, <span class="s13">\lin</span>, 0, 1.5],</p>
<p class="p11"><br></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\relOverlaps</span>, [0.5, 3, <span class="s13">\lin</span>, 0, 2] ! <span class="s17">~n</span>,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\overlapMulLo</span>, [0.1, 2, <span class="s13">\lin</span>, 0, 0.25],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\overlapMulHi</span>, [0.1, 2, <span class="s13">\lin</span>, 0, 1.8],</p>
<p class="p11"><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\panMul</span>, [0.0, 1, <span class="s13">\lin</span>, 0.0, 0.8],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\amp</span>, [0.0, 3, <span class="s13">\lin</span>, 0.01, 1.8]</p>
<p class="p12"><span class="Apple-tab-span">	</span>],[</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\out</span>, c.index,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\sndBuf</span>, b.bufnum,</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\posLo</span>, [0, 1, <span class="s13">\lin</span>, 0.005, 0.1],<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\posHi</span>, [0, 1, <span class="s13">\lin</span>, 0.005, 0.9],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\posRateE</span>, [-3, 4, <span class="s13">\lin</span>, -1, 0],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\posRateM</span>, [0.1, 10, <span class="s13">\exp</span>, 0.01, 1],</p>
<p class="p12"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s13">\posDev</span>, [0, 0.2, 5, 0, 0.01]</p>
<p class="p12"><span class="Apple-tab-span">	</span>],<span class="Apple-converted-space"> </span></p>
<p class="p22"><span class="s2"><span class="Apple-tab-span">	</span>p, </span>\bufPhasor_2</p>
<p class="p12">).gui(</p>
<p class="p12"><span class="Apple-tab-span">	</span>tryColumnNum: 2,</p>
<p class="p12"><span class="Apple-tab-span">	</span>sliderPriority: <span class="s13">\synth</span>,<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>playerPriority: <span class="s13">\synth</span>,</p>
<p class="p12"><span class="Apple-tab-span">	</span>varColorGroups: (0..(<span class="s17">~n</span>*3+12)).clumps([2,3,<span class="s17">~n</span>+2,<span class="s17">~n</span>+2,<span class="s17">~n</span>+2,1,1]),<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>synthColorGroups: (0..6).clumps([1,1,2,2,1]),<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="Apple-tab-span">	</span>labelWidth: 90,</p>
<p class="p12"><span class="Apple-tab-span">	</span>sliderWidth: 300</p>
<p class="p12">);    </p>
<p class="p12">)<span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p9"><b><span class="s3">4.) Extensions of Setups</span></b></p>
<p class="p23"><br></p>
<p class="p2"><br></p>
<p class="p1">.)<span class="Apple-tab-span">	</span><b>Changing ranges and scaling</b></p>
<p class="p2"><br></p>
<p class="p4"><span class="Apple-tab-span">	</span>This concerns all control parameters in question. E.g. the layering of long grains (&gt; 200 ms) in connection with small rates of position changes (posRate) often has interesting effects. One may want to drop the term granulation in that case, though it's the same structure of synthesis. For such parameters with a very large coefficient boundHi / boundLo one may take exponential scaling, and if this is not fine enough you can invent a control pair of mantissa and exponent (as for posRate in Ex. 1b).</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1">.)<span class="Apple-tab-span">	</span><b>Parameter linkage</b></p>
<p class="p2"><br></p>
<p class="p4"><span class="Apple-tab-span">	</span>On the one hand a logical restriction, on the other hand it can make sense from a musical / perceptional point of view. E.g. shortening of grains could be linked with a raise of rate (as low frequencies might fail to unfold in short grains). Anyway parameter linkage is reducing complexity - it's a trade-off between simplicity of the interface and exclusion of certain constellations which should be considered from case to case.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p4">.)<span class="Apple-tab-span">	</span><b>Inventing and extending controls and LFO changes dependant on specific buffers and parameter sets</b></p>
<p class="p2"><br></p>
<p class="p33"><span class="Apple-tab-span">	</span>Say one has started playing around with a certain buffer and a general granulation patch. A parameter set that gives an interesting sound may react in a very interesting way on a change of a single parameter e.g., trigger rate. Then it may be an option to build in a control or a LFO specifically designed for that parameter - LFO is meant here in a general sense, it could be a LFO in a Synth, a dedicated LFO synth or defined by a rapidly sequencing Pattern.</p>
<p class="p34"><br></p>
<p class="p33">.)<span class="Apple-tab-span">	</span><b>Iterated granulation</b></p>
<p class="p34"><br></p>
<p class="p33"><span class="Apple-tab-span">	</span>Granulation of buffers themselves resulting from buffer granulation can give interesting effects.</p>
<p class="p34"><br></p>
<p class="p33">.)<span class="Apple-tab-span">	</span><b>Spatialization</b></p>
<p class="p34"><br></p>
<p class="p33"><span class="Apple-tab-span">	</span>For the sake of ease and comparison a L/R-switch per grain with one panning parameter was used in the examples above. Needless to say that spatial scattering of grains remains a large field of experimentation. Generally spoken spatialization can be part of the synthesis process or carried through independently afterwards, but also a combination of both approaches is feasible.</p>
<p class="p34"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p33">.)<span class="Apple-tab-span">	</span><b>Effects</b></p>
<p class="p34"><br></p>
<p class="p33"><span class="Apple-tab-span">	</span>Effect processing can be applied to all or single grains in a language-driven granulation setup. There can be one or more effects, serial or in parallel, defined outside or inside the Synth playing the buffer, as with the BPF in Ex 2b - 2d. In these examples the bandpass is applied in general, but also a sequencing of effects can be done. And even in the case of just one effect (e.g. reverb) a decent sequencing of Fx- / noFx-events can sound very interesting. This can be done with PbindFx, sequencing not more than one effect per grain can be done straightly: continously running effect synths read from different buses and events with different out values cause the player synths to output to these buses.<span class="Apple-converted-space"> <span class="Apple-tab-span">	</span></span></p>
<p class="p34"><span class="Apple-tab-span">	</span></p>
<p class="p34"><span class="Apple-converted-space"> </span></p>
<p class="p34"><span class="Apple-converted-space"> </span></p>
<p class="p34"><span class="Apple-converted-space"> </span></p>
<p class="p34"><span class="Apple-converted-space"> </span></p>
</body>
</html>
